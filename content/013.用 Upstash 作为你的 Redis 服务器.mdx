---
title: ç”¨ Upstash ä½œä¸ºä½ çš„ Redis æœåŠ¡å™¨
description: åˆæœ‰ä¸€ä¸ªçœå¿ƒçœäº‹çš„å·¥å…·äº†ï¼Œä¸ªäººé¡¹ç›®å¼€å‘å¦‚æœè§‰å¾—è‡ªå·±å®‰è£…ç»´æŠ¤ Redis å¾ˆéº»çƒ¦ï¼Œé‚£ä¹ˆä½ åº”è¯¥è¯•è¯•è¿™ä¸ªå…è´¹çš„ç¬¬ä¸‰æ–¹ Redis æ‰˜ç®¡å¹³å°â€”â€”Upstashã€‚
slug: using-upstash-as-redis-server
slugId: 6510121c-90da-4d20-85a1-72cbbdb3983b
tags: NextJS,NextJSå®æˆ˜,Redis
date: 2023-08-30
---

æœ¬æ–‡ç»§ç»­æˆ‘ä»¬çš„å®æˆ˜æ•™ç¨‹ï¼ˆ[æºç ](https://github.com/weijunext/nextjs-learn-demos)ï¼‰ï¼Œä»Šå¤©ç»™å¤§å®¶æ¨èä¸€ä¸ªå…è´¹çš„ Redis æœåŠ¡å™¨ï¼Œå®ƒå« Upstashã€‚

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸ªäººäº§å“ï¼Œé‚£ä¹ˆè¯·å¿˜æ‰ Redis çš„é…ç½®å’Œå„ç§å®‰å…¨æªæ–½ï¼Œç”¨ Upstashï¼Œä»€ä¹ˆ RDB å’Œ AOFã€é›ªå´©å’Œå‡»ç©¿ã€å¯†ç å’Œæƒé™ï¼Œè¿™äº› Upstash ä¼šå¸®ä½ æå®šï¼Œä½ åªéœ€è¦å…³æ³¨ä½ è¦å®ç°çš„åŠŸèƒ½ã€‚

æœ¬æ–‡å‡å®šä½ å·²äº†è§£ Redis çš„åŸºæœ¬æ¦‚å¿µï¼Œé˜…è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†å­¦ä¹ åˆ°ï¼š

- åˆ›å»ºä¸€ä¸ª Upstash çš„ Redis æ•°æ®åº“
- NextJS æœåŠ¡ç«¯ç»„ä»¶å’Œ Redis äº¤äº’

## åˆ›å»º Redis æ•°æ®åº“

ä¸‡äº‹å¼€å¤´éœ€æ³¨å†Œï¼Œè¯·åˆ° https://upstash.com/ æ³¨å†Œç™»å½•ï¼Œå¼€å§‹å’±ä»¬çš„æ•™ç¨‹ã€‚

é¦–æ¬¡è¿›å…¥åå°ï¼Œçœ‹åˆ°çš„æ˜¯è¿™æ ·çš„ç•Œé¢

![1.png](/assets/013/1.png)

åˆ›å»º Redis æ•°æ®åº“

![2.png](/assets/013/2.png)

ç¨ç­‰ç‰‡åˆ»å°±åˆ›å»ºå®Œæˆäº†ï¼ŒRedis ä¿¡æ¯ä¸€è§ˆæ— ä½™ã€‚

![3.png](/assets/013/3.png)

è¿™ç§æ–¹å¼åˆ›å»ºRedisï¼Œç›¸ä¿¡è¦æ¯”æˆ‘ä»¬æ‰‹åŠ¨åœ¨æœ¬åœ°å®‰è£…Redisã€åˆ†é…dbè¦æµç•…çš„å¤šå§ã€‚ä¸‹é¢è¿›å…¥æ­£é¢˜ï¼ŒNextJSä¸­ æ€ä¹ˆä½¿ç”¨ Upstash çš„ Redisã€‚

## æœåŠ¡ç«¯ç»„ä»¶è°ƒç”¨

å…ˆå®‰è£…ä¾èµ–

```bash
yarn add @upstash/redis
```

å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨redisï¼Œæ‰€ä»¥åº”è¯¥æŠŠredisé…ç½®å†™åˆ°libé‡Œï¼Œæ–¹ä¾¿è°ƒç”¨

```tsx
// @/lib/redis.ts

import { Redis } from '@upstash/redis'

const redis = new Redis({
  url: `${process.env.UPSTASH_REDIS_REST_URL}`,
  token: `${process.env.UPSTASH_REDIS_REST_TOKEN}`,
})

export default redis
```

åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ç›´æ¥å’Œ redis äº¤äº’

```tsx
// @/app/pages.tsx

â€¦â€¦
import redis from "@/lib/redis";

export default async function Home() {
â€¦â€¦
	await redis.incr("view");
	const view = await redis.get("view")

	return (
		<>
			â€¦â€¦
				<span className="flex max-w-fit items-center justify-center space-x-2 rounded-full border border-gray-300 bg-white px-5 py-2 text-sm text-gray-600 shadow-md transition-colors hover:border-gray-800">
          <TablerEyeFilled />
          <p>
            <span className="hidden sm:inline-block">Page Views</span>{" "}
            <span className="font-semibold">{nFormatter(view)}</span>
          </p>
        </span>
			â€¦â€¦
		</>
	) 

â€¦â€¦
}
```

å¦‚æœä½ ç–‘æƒ‘ä¸ºä»€ä¹ˆç»„ä»¶å†…å¯ä»¥ç›´æ¥è°ƒç”¨redisï¼Œé‚£ä¹ˆè¯·çœ‹æˆ‘çš„è¿‡å¾€æ–‡ç« ï¼š

- **[NextJS v13 çš„æ¸²æŸ“æœºåˆ¶æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ](/article/nextjs-v13-rendering)**
- **[NextJS v13æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶åŠæœ€ä½³å®è·µ](/article/nextjs-v13-server-side-and-client-side-components-best-practices)**

ä» demo ä¸­å¯ä»¥çŸ¥é“ï¼ŒUpstash çš„ redis å‘½ä»¤å’Œ Nodeå¼€å‘è€…ç†Ÿæ‚‰çš„ ioredis å‡ ä¹ä¸€æ ·ï¼Œæ‰€ä»¥ Upstash ä½¿ç”¨èµ·æ¥ä¸ä¼šæœ‰ä»»ä½•å¿ƒç†é—¨æ§›ã€‚

æˆ‘ä»¬çœ‹çœ‹æ§åˆ¶å°ï¼Œç¡®è®¤ redis æ˜¯å¦è¢«æ­£ç¡®æ“ä½œäº†ï¼š

![4.png](/assets/013/4.png)

å½“æˆ‘ä»¬åˆ·æ–°å‡ æ¬¡é¡µé¢åï¼Œåœ¨ Usage é¡µå¡ä¸‹å¯ä»¥çœ‹åˆ°å‘½ä»¤è°ƒç”¨æ¬¡æ•°ï¼›

![5.png](/assets/013/5.png)

åœ¨ Data Browser å¯ä»¥çœ‹åˆ° Redis é‡Œçš„æ‰€æœ‰æ•°æ®ã€‚

å†çœ‹é¡µé¢ï¼Œæ•°æ®å’Œæ§åˆ¶å°ç›¸ç¬¦ï¼Œè¯´æ˜ä»¥ä¸Šä»£ç æ²¡æœ‰é—®é¢˜ã€‚

![6.png](/assets/013/6.png)

## ç»“è¯­

Upstash è¿™æ ·çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡å¹³å°ï¼Œæ¯”è¾ƒé€‚åˆä¸ªäººå¼€å‘è€…çš„ä¸ªäººé¡¹ç›®ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿè®©ä½ æœ€è½»é‡åˆå®‰å…¨åœ°ç”¨ä¸Š Redisï¼Œä½ è¦åšçš„åªæ˜¯å­¦ä¹ å¸¸ç”¨çš„ Redis çš„å‘½ä»¤ã€‚

## æºç ä¸æ¼”ç¤º

æºç ï¼šğŸ‘‰[Upstash](https://github.com/weijunext/nextjs-learn-demos/tree/Upstash)

åœ¨çº¿æ¼”ç¤ºï¼šğŸ‘‰[Upstashè®°å½•ç½‘ç«™é¦–é¡µè®¿é—®é‡](https://nextjs.weijunext.com/)

## ä¸“æ èµ„æº

ä¸“æ ä»‹ç»ï¼šä»¥å®æˆ˜çš„è§’åº¦è¿›è¡ŒNext.jsç”Ÿæ€åœˆçš„æŠ€æœ¯æ ˆåˆ†äº«ï¼Œå†…å®¹åŒ…æ‹¬ä½†ä¸é™äºï¼šNext.jsç†è®ºçŸ¥è¯†ã€åŠŸèƒ½æ¨¡å—è®¾è®¡æ€è·¯ã€å®æˆ˜ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ ˆã€‚è¿™æ˜¯ä¸€ä¸ªé•¿æœŸæ›´æ–°çš„ä¸“æ ï¼Œæˆ‘ä¼šæŒç»­æŠŠè‡ªå·±çš„æ€è€ƒå’Œç»éªŒæç‚¼åˆ†äº«å‡ºæ¥ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„ä¸“æ ğŸ‘‡

ä¸“æ åœ°å€ï¼šğŸ‘‰[Next.jsç”Ÿæ€åœˆå®æˆ˜](/tag/NextJS%E5%AE%9E%E6%88%98)

ä¸“æ æ¼”ç¤ºç«™ï¼šğŸ‘‰[Next.js Demos](https://nextjs.weijunext.com)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)