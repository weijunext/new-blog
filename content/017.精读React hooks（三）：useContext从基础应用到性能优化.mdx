---
title: ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–
description: useContextä¸ºæˆ‘ä»¬è§£å†³å¤šå±‚åµŒå¥—ä¼ å€¼çš„é—®é¢˜ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºäº†useContextè·¨å±‚çº§ç»„ä»¶å…±äº«çŠ¶æ€çš„çŸ¥è¯†å’Œæ€§èƒ½æ–¹é¢çš„æ³¨æ„é¡¹ã€‚
slug: react-hook-useContext
slugId: 99d401ae-7428-405d-8af5-5c23c582dec8
tags: React
date: 2023-09-05
---

ä¸Šä¸€ç¯‡æ–‡ç« ï¼ˆ[å…¨é¢æŒæ¡useReducer](/article/react-hook-useReducer)ï¼‰æˆ‘ä»¬ç”¨`useReducer`å’Œ`useContext`å®ç°äº†ä¸€ä¸ªåˆ‡æ¢ä¸»é¢˜çš„åŠŸèƒ½ï¼Œ`useReducer`æˆ‘ä»¬å·²ç»æŒæ¡äº†ï¼Œé‚£ä¹ˆæœ¬æ–‡å°±æ¥å­¦ä¹ `useContext`ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ª`hook`çš„è¯ç”Ÿéƒ½æœ‰å®ƒç‹¬ç‰¹çš„ä½¿å‘½ï¼Œæ¯”å¦‚`useState`æ˜¯è§£å†³ç»„ä»¶å†…çŠ¶æ€æ›´æ–°çš„é—®é¢˜ï¼Œ`useReducer`æ˜¯è§£å†³ç»„ä»¶å¤æ‚çŠ¶æ€æ›´æ–°çš„é—®é¢˜ã€‚

è€Œ`useContext`è¦è§£å†³çš„æ˜¯ï¼š**è®©å¼€å‘è€…åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä»å¤šå±‚åµŒå¥—ä¼ å€¼çš„ç»„ä»¶æ ‘ä¸­è§£è„±å‡ºæ¥**ï¼›`useContext`å®ç°çš„æ˜¯ï¼š**è®©å¼€å‘è€…é€šè¿‡`context`å®ç°è·¨å±‚çº§å…±äº«çŠ¶æ€**ã€‚

## åŸºç¡€ç”¨æ³•

1. **åˆ›å»º Context**

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`React.createContext`åˆ›å»ºä¸€ä¸ª`context`å¯¹è±¡ï¼š

```jsx
const MyContext = React.createContext(defaultValue);
```

è¿™é‡Œçš„`defaultValue`æ˜¯å½“ç»„ä»¶ä¸åœ¨ä»»ä½• Context Provider å†…éƒ¨æ—¶çš„é»˜è®¤å€¼ï¼Œ`defaultValue`å¯ä»¥ç”¨ nullï¼Œä½† React å®˜æ–¹å»ºè®®æä¾›ä¸€ä¸ªæœ‰æ„ä¹‰çš„é»˜è®¤å€¼ï¼Œè¿™æ ·å¯ä»¥è®©è°ƒç”¨`usecontext`ç»„ä»¶æ›´å®‰å…¨ã€‚

1. **ä½¿ç”¨ Context Provider**

ä¸ºäº†åœ¨ç»„ä»¶æ ‘ä¸­ä½¿ç”¨è¿™ä¸ª`context`ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`<MyContext.Provider>`ç»„ä»¶ï¼Œå®ƒæ¥å—ä¸€ä¸ª`value`propï¼Œè¿™å°±æ˜¯ä½ æƒ³åœ¨å®ƒçš„å­ç»„ä»¶ä¸­å…±äº«çš„å€¼ã€‚

```jsx
<MyContext.Provider value={someValue}>
  {/* å­ç»„ä»¶ */}
</MyContext.Provider>
```

1. **åœ¨ç»„ä»¶ä¸­è®¿é—® Context**

åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`useContext`hook æ¥è®¿é—®è¿™ä¸ª context çš„å€¼ã€‚

```jsx
function MyComponent() {
  const contextValue = useContext(MyContext);
  return <div>{contextValue}</div>;
}
```

è¿™é‡Œçš„`contextValue`å°±æ˜¯ç¬¬äºŒæ­¥ä¼ å…¥çš„`someValue`ï¼Œè€Œä¸”`contextValue`è·å–åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°çš„å€¼ã€‚

### ä¸€ä¸ªç¤ºä¾‹

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´ç›´è§‚çš„ç¤ºä¾‹ï¼š

```jsx
import React, { useContext } from 'react';

// 1. åˆ›å»º Context
const ThemeContext = React.createContext('light');

function App() {
  return (
    // 2. ä½¿ç”¨ Context Provider
    <ThemeContext.Provider value="dark">
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemeButton />
    </div>
  );
}

function ThemeButton() {
  // 3. åœ¨ç»„ä»¶ä¸­è®¿é—® Context
  const theme = useContext(ThemeContext);
  return <button>{theme} theme</button>;
}

export default App;
```

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒApp ä¸­å¼•ç”¨äº†`ThemeContext`å¹¶ä¼ äº†å€¼ï¼ŒThemeButton æ˜¯ App çš„å­™ç»„ä»¶ï¼Œè¿™äºŒè€…ä¹‹é—´æ²¡æœ‰é€šè¿‡ Toolbar è¿›è¡ŒåµŒå¥—ä¼ å€¼ï¼Œä½†æ˜¯ ThemeButton ä¾ç„¶é€šè¿‡`useContext`æ‹¿åˆ°äº† App é‡Œçš„å€¼ã€‚

ä»è¿™ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼Œ`React.createContext`å’Œ`useContext`å…±åŒç»„æˆäº†ä¸€ä¸ªç®¡é“ï¼Œé€šè¿‡è¿™ä¸ªç®¡é“ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œè·¨ç»„ä»¶å…±äº«çŠ¶æ€ã€‚

## è¿›é˜¶æŠ€å·§

### åŠ¨æ€Contextå€¼

æœ‰çš„æ—¶å€™ Context ä¼ çš„å€¼éœ€è¦åŠ¨æ€å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºuseStateå»æ›´æ–°çŠ¶æ€ï¼Œæ›´æ–°åçš„å€¼ä¼šå®æ—¶ååº”åˆ°è°ƒç”¨ Context çš„ç»„ä»¶ä¸Šã€‚

```jsx
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState("light");

  return (
    <ThemeContext.Provider value={theme}>
      <button onClick={() => setTheme(theme === "light" ? "dark" : "light")}>
        Toggle Theme
      </button>
      {children}
    </ThemeContext.Provider>
  );
}
```

å¦‚æœè¦æ›´æ–°å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š

```
import React, { useContext } from 'react';

// 1. åˆ›å»º Context
const CurrentUserContext = React.createContext('light');

function App() {
	const [currentUser, setCurrentUser] = useState(null
  return (
    // 2. ä½¿ç”¨ Context Provider
    <CurrentUserContext.Provider 
			value={{
        currentUser,
        setCurrentUser
      }}
		>
      <Toolbar />
    </CurrentUserContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <LoginButton />
    </div>
  );
}

function LoginButton() {
  const {
    currentUser,
    setCurrentUser
  } = useContext(CurrentUserContext);

  if (currentUser !== null) {
    return <p>You logged in as {currentUser.name}.</p>;
  }

  return (
    <Button onClick={() => {
      setCurrentUser({ name: 'Advika' })
    }}>Log in as Weijunext</Button>
  );
}

export default App;
```

### å’ŒuseReducerå…±ç”¨

åœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šå°†`useContext`ä¸`useReducer`ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥ä¾¿ä»ç»„ä»¶ä¸­æå–ä¸æŸäº›çŠ¶æ€ç›¸å…³çš„é€»è¾‘ã€‚ä¸Šä¸€ç¯‡æ–‡ç« å³æ˜¯ç”¨è¿™ç§æ€è·¯å®ç°äº†ä¸»é¢˜åˆ‡æ¢ï¼Œæºç å¯æŸ¥çœ‹Githubï¼š[useReducer-useContextå®ç°ä¸»é¢˜åˆ‡æ¢](https://github.com/weijunext/nextjs-learn-demos/tree/useReducer-useContext)ï¼Œæœ¬æ–‡ä¸å†é‡å¤ã€‚

### è¦†ç›–Provider value

å½“æˆ‘ä»¬è°ƒç”¨å¤šä¸ªç›¸åŒ Contextï¼Œä¼šå®ç°`value`çš„è¦†ç›–

```jsx
<ThemeContext.Provider value="dark">
  ...
  <ThemeContext.Provider value="light">
    <Footer />
  </ThemeContext.Provider>
  ...
</ThemeContext.Provider>
```

## é«˜çº§åº”ç”¨â€”â€”æ€§èƒ½ä¼˜åŒ–

å½“æˆ‘ä»¬åœ¨ä½¿ç”¨`useContext`æ—¶ï¼Œä¸€ä¸ªç»å¸¸è¢«æåˆ°çš„é—®é¢˜æ˜¯æ€§èƒ½ä¼˜åŒ–ã€‚å¦‚æœä¸æ­£ç¡®åœ°ä½¿ç”¨ï¼ŒContext å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„ç»„ä»¶æ¸²æŸ“ï¼Œä»è€Œå½±å“åº”ç”¨æ€§èƒ½ã€‚

### **ä¸ºä»€ä¹ˆä¼šå‡ºç°æ€§èƒ½é—®é¢˜ï¼Ÿ**

å½“`Provider`çš„`value`å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨äº†`useContext`çš„ç»„ä»¶éƒ½å°†é‡æ–°æ¸²æŸ“ã€‚å¦‚æœ`value`ç»å¸¸å˜åŒ–ï¼Œæˆ–è€…æ¶ˆè´¹è€…ç»„ä»¶å¾ˆå¤šï¼Œé‚£ä¹ˆè¿™ä¼šå¼•èµ·å¤§é‡çš„ä¸å¿…è¦çš„æ¸²æŸ“ã€‚

### **æ€æ ·è§£å†³ï¼Ÿ**

- **ç²’åº¦åŒ– Context**
    
    å¦‚æœä½ çš„ context åŒ…å«è®¸å¤šä¸åŒçš„çŠ¶æ€å€¼ï¼Œå°è¯•å°†å®ƒä»¬åˆ†è§£æˆæ›´å°çš„ contextã€‚ä¾‹å¦‚ï¼Œè€Œä¸æ˜¯åªæœ‰ä¸€ä¸ªå¤§çš„ AppContextï¼Œä½ å¯ä»¥æœ‰ UserContextã€ThemeContext ç­‰ã€‚è¿™æ ·ï¼Œå½“æŸä¸€éƒ¨åˆ†çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªæœ‰ä¾èµ–äºé‚£éƒ¨åˆ†æ•°æ®çš„ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ã€‚
    
    ```jsx
    import { createContext, useContext, useState } from 'react';
    
    const ThemeContext = createContext(null);
    const CurrentUserContext = createContext(null);
    
    export default function MyApp() {
      const [theme, setTheme] = useState('light');
      const [currentUser, setCurrentUser] = useState(null);
      return (
        <ThemeContext.Provider value={theme}>
          <CurrentUserContext.Provider
            value={{
              currentUser,
              setCurrentUser
            }}
          >
    	      <Toolbar />
    				<button onClick={() => setTheme(theme === "light" ? "dark" : "light")}>
    	        Toggle Theme
    	      </button>
          </CurrentUserContext.Provider>
        </ThemeContext.Provider>
      )
    }
    ```
    
- **ä½¿ç”¨å¤šä¸ª Context æä¾›è€…**
    
    è¿™ä¸ä¸Šä¸€ç‚¹ç›¸ä¼¼ã€‚ä½ å¯ä»¥ä¸ºåº”ç”¨ä¸­çš„ä¸åŒéƒ¨åˆ†ä½¿ç”¨ä¸åŒçš„ context æä¾›è€…ï¼Œç¡®ä¿ä»…å½“çœŸæ­£éœ€è¦çš„æ•°æ®æ›´æ”¹æ—¶æ‰é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
    
- **ä½¿ç”¨`useMemo`å’Œ`useCallback`ä¼˜åŒ–`value`**
    
    ä¸ºäº†é¿å…`value`å˜åŒ–é€ æˆå­å­™ç»„ä»¶é¢‘ç¹çš„é‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨`useMemo`å’Œ`useCallback`å¯¹å‚æ•°å’Œæ–¹æ³•è¿›è¡Œç¼“å­˜ï¼Œå‡å°‘`value`çš„æ— æ„ä¹‰æ›´æ–°ã€‚
    
    ```jsx
    import { useCallback, useMemo } from 'react';
    
    function MyApp() {
      const [currentUser, setCurrentUser] = useState(null);
    
      const login = useCallback((response) => {
        storeCredentials(response.credentials);
        setCurrentUser(response.user);
      }, []);
    
      const contextValue = useMemo(() => ({
        currentUser,
        login
      }), [currentUser, login]);
    
      return (
        <AuthContext.Provider value={contextValue}>
          <Page />
        </AuthContext.Provider>
      );
    }
    ```
    

æ³¨ï¼šå¦‚æœä½ çš„åº”ç”¨çŠ¶æ€ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œå¹¶è§¦å‘å¤§é‡ç»„ä»¶çš„æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸é€‚åˆç”¨`useContext`ï¼Œè¯·ç«‹å³è€ƒè™‘å…¶å®ƒçŠ¶æ€æ›´æ–°æ–¹æ¡ˆã€‚

## ç»“è¯­

å¸Œæœ›æœ¬æ–‡æ‰€è®²çš„useContextåº”ç”¨å’ŒæŠ€å·§èƒ½å¸®åŠ©ä½ æŒæ¡`useContext`hookã€‚

## ä¸“æ èµ„æº

ä¸“æ åšå®¢åœ°å€ï¼š[ç²¾è¯»React Hooks](/tag/React)

ä¸“æ æ¼”ç¤ºç«™ï¼š[React Hooks Demos](https://nextjs.weijunext.com/hooks)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)

ä¸“æ æ–‡ç« åˆ—è¡¨ï¼š

[ç²¾è¯»React hooksï¼ˆä¸€ï¼‰ï¼šuseState çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•å’Œè¿›é˜¶æŠ€å·§](/article/react-hook-useState)

[ç²¾è¯»React hooksï¼ˆäºŒï¼‰ï¼šReactçŠ¶æ€ç®¡ç†çš„å¼ºå¤§å·¥å…·â€”â€”useReducer](/article/react-hook-useReducer)

[ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–](/article/react-hook-useContext)

[ç²¾è¯»React hooksï¼ˆå››ï¼‰ï¼šuseRefçš„å¤šç»´ç”¨é€”](/article/react-hook-useRef)

[ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ](/article/react-hook-useEffect)

[ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](/article/react-hook-useLayoutEffect)

[ç²¾è¯»React hooksï¼ˆä¸ƒï¼‰ï¼šç”¨useMemoæ¥å‡å°‘æ€§èƒ½å¼€é”€](/article/react-hook-useMemo)

[ç²¾è¯»React hooksï¼ˆå…«ï¼‰ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦useCallback](/article/react-hook-useCallback)

[ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“](/article/react-hook-useTransition)

[ç²¾è¯»React hooksï¼ˆåï¼‰ï¼šä½¿ç”¨useDeferredValueå»¶è¿ŸçŠ¶æ€æ›´æ–°](/article/react-hook-useDeferredValue)

[ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼](/article/react-hook-useInsertionEffect)

[ç²¾è¯»React hooksï¼ˆåäºŒï¼‰ï¼šä½¿ç”¨useImperativeHandleèƒ½è·å¾—ä»€ä¹ˆèƒ½åŠ›](/article/react-hook-useImperativeHandle)

[ç²¾è¯»React hooksï¼ˆåä¸‰ï¼‰ï¼šä½¿ç”¨useSyncExternalStoreè·å–å®æ—¶æ•°æ®](/article/react-hook-useSyncExternalStore)

[ç²¾è¯»React hooksï¼ˆåå››ï¼‰ï¼šæ€»æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦useIdä¸ºä½ ç”Ÿæˆå”¯ä¸€id](/article/react-hook-useId)

[ç²¾è¯»React hooksï¼ˆåäº”ï¼‰ï¼šæŠŠuseDebugValueåŠ å…¥ä½ çš„Reactè°ƒè¯•å·¥å…·åº“](/article/react-hook-useDebugValue)

[ç²¾è¯»React hooksï¼ˆåå…­ï¼‰ï¼šä¸€ä¸ªä¸ºä»£ç ä¼˜é›…è€Œç”Ÿçš„hookâ€”â€”use](/article/react-hook-use)