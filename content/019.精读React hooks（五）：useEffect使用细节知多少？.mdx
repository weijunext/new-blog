---
title: ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ
description: useEffectæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ hookï¼Œæ­£å› ä¸ºå¸¸ç”¨å®¹æ˜“è®©å¼€å‘è€…å¿½ç•¥äº†å…¶ä¸­çš„ä½¿ç”¨ç»†èŠ‚ï¼Œæœ¬æ–‡æ¢³ç†äº†useEffectçš„ä½¿ç”¨ç»†èŠ‚å’Œæ¸…é™¤å‡½æ•°çš„ä½¿ç”¨åœºæ™¯ã€‚
slug: react-hook-useEffect
slugId: 772e7900-ead5-4468-8a68-599e916bc651
tags: React
date: 2023-09-07
---

## æ¦‚å¿µè§£é‡Š

å½“æˆ‘ä»¬è°ˆè®º Reactï¼Œæˆ‘ä»¬é€šå¸¸åœ¨è®¨è®ºçº¯å‡½æ•°ç»„ä»¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æ²¡æœ‰å‰¯ä½œç”¨ã€‚ä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œå¦‚æ•°æ®è·å–ã€æ‰‹åŠ¨æ›´æ”¹ DOMã€è®¾ç½®è®¢é˜…ç­‰ã€‚`useEffect`å°±æ˜¯ä¸ºæ­¤è®¾è®¡çš„ã€‚

useEffectçš„å®šä¹‰å¦‚ä¸‹ï¼š

```
useEffect(setup, dependencies?)
```

`useEffect`æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

1. **setup å‡½æ•°**ï¼šè¿™æ˜¯åŒ…å«æˆ‘ä»¬çš„ Effect é€»è¾‘çš„å‡½æ•°ã€‚setup å‡½æ•°é‡Œè¿˜å¯ä»¥é€‰æ‹©è¿”å›ä¸€ä¸ª`cleanup`å‡½æ•°ï¼Œ`cleanup`å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œã€‚
2. **ä¾èµ–æ•°ç»„ï¼ˆoptional dependenciesï¼‰**ï¼šè¿™æ˜¯ setup ä»£ç å†…éƒ¨å¼•ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ã€‚å“åº”å¼å€¼åŒ…æ‹¬ propsã€state ä»¥åŠç›´æ¥åœ¨ç»„ä»¶ä¸»ä½“ä¸­å£°æ˜çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚ä¾èµ–æ•°ç»„å¯ä»¥ä¸ä¼ é€’ã€ä¼ ç©ºæ•°ç»„å’Œéç©ºæ•°ç»„ã€‚

## ç”¨æ³•è¯¦è§£

### åŸºç¡€ä½¿ç”¨

æœ€ç®€å•çš„ç”¨æ³•ï¼Œåœ¨`useEffect`å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆä¾‹å¦‚ï¼šæ•°æ®è·å–ã€æ‰‹åŠ¨ä¿®æ”¹ DOMã€è®¢é˜…äº‹ä»¶ç­‰ï¼‰ã€‚

```jsx
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `ç‚¹å‡»äº† ${count} æ¬¡`;
  });

  return (
    <div>
      <p>ç‚¹å‡»äº† {count} æ¬¡</p>
      <button onClick={() => setCount(count + 1)}>ç‚¹å‡»æˆ‘</button>
    </div>
  );
}
```

### ä¸åŒçš„ä¾èµ–æ•°ç»„çš„åŒºåˆ«

ç°åœ¨å‡çº§ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ï¼Œæ¥çœ‹çœ‹ä¸åŒä¾èµ–æ•°ç»„ï¼ˆoptional dependenciesï¼‰æœ‰ä»€ä¹ˆåŒºåˆ«

```jsx
import React, { useState, useEffect } from 'react';

function Example() {
		const [leftCount, setLeftCount] = useState(0);
    const [rightCount, setRightCount] = useState(0);

    useEffect(() => {
      /**
       * This useEffect will be executed when:
       * 1ã€the component is mounted and unmounted.
       * 2ã€click left button.
       * 3ã€click right button.
       */
      console.log(`Button left clicked ${leftCount} times`);
      document.title = `Button left clicked ${leftCount} times`;
    });

		useEffect(() => {
      /**
       * This useEffect will be executed when:
       * 1ã€the component is mounted and unmounted.
       * 2ã€click right button.
       */
      console.log(`Button right clicked ${rightCount} times`);
    }, [rightCount]);
  
    useEffect(() => {
      /**
       * This useEffect will be executed when:
       * 1ã€the component is mounted and unmounted.
       */
      console.log(`I have a empty array of dependencies.`);
    }, []);

    return (
        <div className="flex">
						<div>
              <p>å·¦æŒ‰é’®ç‚¹å‡»äº† {leftCount} æ¬¡</p>
              <button onClick={() => setLeftCount(count + 1)}>å·¦æŒ‰é’®</button>
						</div>
						<div>
              <p>å³æŒ‰é’®ç‚¹å‡»äº† {rightCount} æ¬¡</p>
              <button onClick={() => setRightCount(count + 1)}>å³æŒ‰é’®</button>
						</div>
        </div>
    );
}
```

ç¤ºä¾‹ä»£ç  TypeScript ç‰ˆå·²å‘å¸ƒåˆ°æˆ‘çš„[Github](https://github.com/weijunext/nextjs-learn-demos/tree/useEffect)ï¼Œæ¼”ç¤ºDemoå·²å‘å¸ƒåˆ°[æˆ‘çš„ç¤ºä¾‹ç«™](https://nextjs.weijunext.com/hooks/useEffect)

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å†™äº†3ä¸ª`useEffect`ï¼Œæ·»åŠ äº†ä¸åŒçš„ä¾èµ–æ•°ç»„ï¼Œå®ƒä»¬åˆ†åˆ«ä¼šæœ‰è¿™æ ·çš„è¡¨ç°ï¼š

- ç¬¬ä¸€ä¸ª`useEffect`æ²¡æœ‰æ·»åŠ ä¾èµ–æ•°ç»„ï¼Œå®ƒçš„è§¦å‘æ—¶æœºæœ‰ï¼š
    - ç»„ä»¶æŒ‚è½½ã€å¸è½½çš„æ—¶å€™
    - é¡µé¢æ¯ä¸€æ¬¡`re-render`çš„æ—¶å€™ï¼Œå³`leftCount`å’Œ`rightCount`æ›´æ–°çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å·¦æŒ‰é’®å’Œå³æŒ‰é’®ç‚¹å‡»çš„æ—¶å€™
- ç¬¬äºŒä¸ª`useEffect`ä¾èµ–æ•°ç»„æ·»åŠ äº†`rightCount`ï¼Œå®ƒçš„è§¦å‘æ—¶æœºæœ‰ï¼š
    - ç»„ä»¶æŒ‚è½½ã€å¸è½½çš„æ—¶å€™
    - `rightCount`è§¦å‘çš„re-renderçš„æ—¶å€™ï¼Œå³`rightCount`æ›´æ–°çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å³æŒ‰é’®ç‚¹å‡»çš„æ—¶å€™
- ç¬¬ä¸‰ä¸ªuseEffectä¾èµ–æ•°ç»„è¯´ç©ºçš„ï¼Œå®ƒçš„è§¦å‘æ—¶æœºæœ‰ï¼š
    - ç»„ä»¶æŒ‚è½½ã€å¸è½½çš„æ—¶å€™

ç»¼ä¸Šï¼Œæˆ‘ä»¬åªåº”è¯¥åœ¨å¿…è¦çš„æ—¶å€™ç»™`useEffect`æ·»åŠ ä¾èµ–é¡¹ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

è¿™ä¸ªç¤ºä¾‹ä¹Ÿè¯´æ˜äº†ï¼Œåœ¨å•ä¸ªç»„ä»¶ä¸­å…è®¸ä½¿ç”¨å¤šä¸ª`useEffect`ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸åŒçš„å…³æ³¨ç‚¹å°†å‰¯ä½œç”¨é€»è¾‘åˆ†å¼€ã€‚

### æ¸…é™¤å‡½æ•°çš„ä½œç”¨

å¼€ç¯‡æˆ‘ä»¬è¿˜æåˆ°ä¸€ä¸ª`cleanup`å‡½æ•°ï¼Œcleanupå‡½æ•°åªåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œï¼Œå®ƒçš„ç”¨æ³•å¦‚ä¸‹ï¼š

```jsx
useEffect(() => {
    â€¦â€¦

    return () => {
        // ç»„ä»¶å¸è½½ä¼šæ‰§è¡Œè¿™é‡Œé¢çš„ä»£ç 
    };
}, []);
```

**åº”ç”¨åœºæ™¯1**ï¼šæ¸…é™¤å®šæ—¶å™¨

å¦‚æœä½ åœ¨`useEffect`ä¸­è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆå¦‚`setTimeout`æˆ–`setInterval`ï¼‰ï¼Œåœ¨ç»„ä»¶å¸è½½å‰ï¼Œä½ åº”è¯¥æ¸…é™¤å®ƒï¼Œä»¥é˜²æ­¢å®ƒåœ¨ç»„ä»¶ä¸åœ¨ DOM ä¸­æ—¶ä»ç„¶æ‰§è¡Œã€‚

```jsx
useEffect(() => {
    const timer = setInterval(() => {
        console.log('console once per second.');
    }, 1000);
    
    return () => {
        clearInterval(timer);
    };
}, []);
```

**åº”ç”¨åœºæ™¯2**ï¼šäº‹ä»¶ç›‘å¬å™¨

ä¸ºå…¨å±€å¯¹è±¡ï¼ˆå¦‚`window`æˆ–`document`ï¼‰æˆ–ç‰¹å®š DOM å…ƒç´ æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨åº”å½“åœ¨ç»„ä»¶å¸è½½æˆ–ä¸å†éœ€è¦å®ƒä»¬æ—¶è¢«ç§»é™¤ã€‚

```jsx
useEffect(() => {
    const handleResize = () => {
        console.log("Window resized!");
    };

    window.addEventListener('resize', handleResize);
    
    return () => {
        window.removeEventListener('resize', handleResize);
    };
}, []);
```

**åº”ç”¨åœºæ™¯3**ï¼šWebSocketsèŠå¤©å®¤

å½“ä½¿ç”¨ WebSockets æˆ–å…¶ä»–å®æ—¶é€šä¿¡æŠ€æœ¯æ—¶ï¼Œä½ å¯èƒ½ä¼šåœ¨ç»„ä»¶åŠ è½½æ—¶å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œè€Œåœ¨ç»„ä»¶å¸è½½æ—¶éœ€è¦æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚

```jsx
useEffect(() => {
    const socket = new WebSocket('ws://weijunext.com/socket');

    socket.onmessage = (event) => {
        console.log(event.data);
    };
    
    return () => {
        socket.close();
    };
}, []);
```

**åº”ç”¨åœºæ™¯4**ï¼šè¯·æ±‚çš„å–æ¶ˆ

å¯¹äºå¯èƒ½åœ¨ç»„ä»¶å¸è½½åæ‰å®Œæˆçš„å¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚ä½¿ç”¨ Axios å‘èµ·çš„ HTTP è¯·æ±‚ï¼‰ï¼Œä½ åº”è¯¥åœ¨ç»„ä»¶å¸è½½å‰å–æ¶ˆå®ƒä»¬ï¼Œä»¥é˜²æ­¢è®¾ç½®å·²å¸è½½ç»„ä»¶çš„çŠ¶æ€ã€‚

```jsx
useEffect(() => {
    const source = axios.CancelToken.source();

    axios.get('/api/some-endpoint', { cancelToken: source.token })
        .then(response => {
            console.log(response.data);
        })
        .catch(error => {
            if (axios.isCancel(error)) {
                console.log('Request cancelled');
            } else {
                console.error(error);
            }
        });
    
    return () => {
        source.cancel('Component unmounted');
    };
}, []);
```

**åº”ç”¨åœºæ™¯5**ï¼šDOM ç›´æ¥æ“ä½œå’Œç¬¬ä¸‰æ–¹ DOM åº“

å¦‚æœä½¿ç”¨äº†ç›´æ¥æ“ä½œ DOM çš„æ–¹æ³•æˆ–ä½¿ç”¨äº†å¦‚ D3ã€animation è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“æ¥æ“ä½œ DOMï¼Œä½ å¯èƒ½éœ€è¦åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†æˆ–è¿˜åŸæŸäº›æ“ä½œã€‚

```jsx
useEffect(() => {
    const animation = new FadeInAnimation(ref.current);
    animation.start(1000);
    return () => {
      animation.stop();
    };
  }, []);
```

### è·³è¿‡åˆå§‹æ¸²æŸ“

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç«‹å³æ‰§è¡ŒæŸäº›æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½åŒ…æ‹¬å‘é€ç½‘ç»œè¯·æ±‚ã€è§¦å‘æŸäº›åŠ¨ç”»æˆ–å…¶ä»–ä»»åŠ¡ã€‚è€Œæ˜¯åªæœ‰åœ¨æŸä¸ªå€¼æˆ–ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–åï¼Œæˆ‘ä»¬æ‰å¸Œæœ›æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª`count`çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å½“`count`å€¼å‘ç”Ÿå˜åŒ–æ—¶æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ï¼Œä½†ä¸å¸Œæœ›åœ¨ç»„ä»¶é¦–æ¬¡åŠ è½½æ—¶æ˜¾ç¤ºè¿™ä¸ªé€šçŸ¥ã€‚

```jsx
import React, { useState, useEffect, useRef } from 'react';

function Counter() {
    const [count, setCount] = useState(0);
    const mounted = useRef(false);

    useEffect(() => {
        if (mounted.current) {
            alert('Count value changed!');
        } else {
            mounted.current = true;
        }
    }, [count]);

    return (
        <div>
            <button onClick={() => setCount(count + 1)}>Increase</button>
            <p>Count: {count}</p>
        </div>
    );
}

export default Counter;
```

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡» Increase æŒ‰é’®å¢åŠ `count`å€¼æ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸ªé€šçŸ¥ã€‚ä½†æ˜¯åœ¨é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œä¸ä¼šæœ‰ä»»ä½•é€šçŸ¥å‡ºç°ã€‚

## ç»“è¯­

`useEffect`æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ hookï¼Œæ­£å› ä¸ºå¸¸ç”¨å®¹æ˜“è®©å¼€å‘è€…å¿½ç•¥äº†å…¶ä¸­çš„ä½¿ç”¨ç»†èŠ‚ï¼Œæœ¬æ–‡ä¸»è¦é’ˆå¯¹ç”¨æ³•ç»†èŠ‚è¿›è¡Œæ¢³ç†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚


## ä¸“æ èµ„æº

ä¸“æ åšå®¢åœ°å€ï¼š[ç²¾è¯»React Hooks](/tag/React)

ä¸“æ æ¼”ç¤ºç«™ï¼š[React Hooks Demos](https://nextjs.weijunext.com/hooks)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)

ä¸“æ æ–‡ç« åˆ—è¡¨ï¼š

[ç²¾è¯»React hooksï¼ˆä¸€ï¼‰ï¼šuseState çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•å’Œè¿›é˜¶æŠ€å·§](/article/react-hook-useState)

[ç²¾è¯»React hooksï¼ˆäºŒï¼‰ï¼šReactçŠ¶æ€ç®¡ç†çš„å¼ºå¤§å·¥å…·â€”â€”useReducer](/article/react-hook-useReducer)

[ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–](/article/react-hook-useContext)

[ç²¾è¯»React hooksï¼ˆå››ï¼‰ï¼šuseRefçš„å¤šç»´ç”¨é€”](/article/react-hook-useRef)

[ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ](/article/react-hook-useEffect)

[ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](/article/react-hook-useLayoutEffect)

[ç²¾è¯»React hooksï¼ˆä¸ƒï¼‰ï¼šç”¨useMemoæ¥å‡å°‘æ€§èƒ½å¼€é”€](/article/react-hook-useMemo)

[ç²¾è¯»React hooksï¼ˆå…«ï¼‰ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦useCallback](/article/react-hook-useCallback)

[ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“](/article/react-hook-useTransition)

[ç²¾è¯»React hooksï¼ˆåï¼‰ï¼šä½¿ç”¨useDeferredValueå»¶è¿ŸçŠ¶æ€æ›´æ–°](/article/react-hook-useDeferredValue)

[ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼](/article/react-hook-useInsertionEffect)

[ç²¾è¯»React hooksï¼ˆåäºŒï¼‰ï¼šä½¿ç”¨useImperativeHandleèƒ½è·å¾—ä»€ä¹ˆèƒ½åŠ›](/article/react-hook-useImperativeHandle)

[ç²¾è¯»React hooksï¼ˆåä¸‰ï¼‰ï¼šä½¿ç”¨useSyncExternalStoreè·å–å®æ—¶æ•°æ®](/article/react-hook-useSyncExternalStore)

[ç²¾è¯»React hooksï¼ˆåå››ï¼‰ï¼šæ€»æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦useIdä¸ºä½ ç”Ÿæˆå”¯ä¸€id](/article/react-hook-useId)

[ç²¾è¯»React hooksï¼ˆåäº”ï¼‰ï¼šæŠŠuseDebugValueåŠ å…¥ä½ çš„Reactè°ƒè¯•å·¥å…·åº“](/article/react-hook-useDebugValue)

[ç²¾è¯»React hooksï¼ˆåå…­ï¼‰ï¼šä¸€ä¸ªä¸ºä»£ç ä¼˜é›…è€Œç”Ÿçš„hookâ€”â€”use](/article/react-hook-use)