---
title: ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
description: useLayoutEffectçš„ç”¨æ³•å’ŒuseEffectå®Œå…¨ä¸€æ ·ï¼Œé‚£ä¹ˆæœ¬æ–‡å°±æ¥è°ˆè°ˆè¿™äºŒè€…åœ¨ä½¿ç”¨åœºæ™¯ä¸Šçš„åŒºåˆ«ï¼Œä»¥åŠuseLayoutEffectçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ã€‚
slug: react-hook-useLayoutEffect
slugId: fe61d9a6-84a1-4315-8e1d-34303cb2a497
tags: React
date: 2023-09-08
---

å¦‚æœä½ ä¼šç”¨`useEffect`ï¼ˆ[**ç²¾è¯»React hookï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ**](/article/react-hook-useEffect)ï¼‰ï¼Œé‚£ä¹ˆä½ ä¸€å®šä¹Ÿä¼šç”¨`useLayoutEffect`ã€‚å› ä¸ºå®ƒä»¬çš„ç”¨æ³•ä¸€æ¨¡ä¸€æ ·ã€‚

`useEffect`å’Œ`useLayoutEffect`çš„åŒºåˆ«ä»…æœ‰ä¸€ä¸ªï¼š

- `useEffect`æ‰§è¡Œæ—¶æœºæ˜¯åœ¨Reactçš„æ¸²æŸ“å’Œæäº¤é˜¶æ®µä¹‹åï¼›
- `useLayoutEffect`æ‰§è¡Œæ—¶æœºæ˜¯åœ¨Reactçš„æäº¤é˜¶æ®µä¹‹åï¼Œä½†åœ¨æµè§ˆå™¨å®é™…ç»˜åˆ¶å±å¹•ä¹‹å‰ã€‚

## useEffect vs useLayoutEffect

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹é˜»å¡å’Œéé˜»å¡å¯¹ç”¨æˆ·æ¥è¯´æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚

```jsx
import React, { useEffect, useLayoutEffect, useState, useRef } from 'react';

function BoxComparison() {
  const [heightEffect, setHeightEffect] = useState(0);
  const [heightLayoutEffect, setHeightLayoutEffect] = useState(0);
  const refEffect = useRef(null);
  const refLayoutEffect = useRef(null);

  useEffect(() => {
    if (refEffect.current) {
      setHeightEffect(refEffect.current.offsetWidth);
    }
  }, []);

  useLayoutEffect(() => {
    if (refLayoutEffect.current) {
      setHeightLayoutEffect(refLayoutEffect.current.offsetWidth);
    }
  }, []);

  return (
    <div>
      <div>
        <h2>ä½¿ç”¨ useEffect</h2>
        <div ref={refEffect} style={{ width: '200px', height: '50px', background: 'lightgray' }}>è¿™æ˜¯ä¸€ä¸ªæ–¹å—</div>
        <div style={{ width: '100px', height: `${heightEffect}px`, background: 'red', marginTop: '10px' }}>çº¢è‰²æ–¹å—</div>
      </div>
      
      <div style={{ marginTop: '30px' }}>
        <h2>ä½¿ç”¨ useLayoutEffect</h2>
        <div ref={refLayoutEffect} style={{ width: '200px', height: '50px', background: 'lightgray' }}>è¿™æ˜¯ä¸€ä¸ªæ–¹å—</div>
        <div style={{ width: '100px', height: `${heightLayoutEffect}px`, background: 'blue', marginTop: '10px' }}>è“è‰²æ–¹å—</div>
      </div>
    </div>
  );
}

export default BoxComparison;
```

è¿™ä¸ªä¾‹å­å†™äº†ä¸¤ä¸ªæ–¹å—ï¼Œåˆ†åˆ«ä½¿ç”¨`useEffect`å’Œ`useLayoutEffect`æ¥æ›´æ–°é«˜åº¦ï¼Œä»£ç å®é™…æ•ˆæœåœ¨[æˆ‘çš„æ¼”ç¤ºç«™](https://nextjs.weijunext.com/hooks/useLayoutEffect)æŸ¥çœ‹ã€‚

å½“ä½ åœ¨æ€§èƒ½è¾ƒå·®çš„è®¾å¤‡ä¸Šè‚‰çœ¼å¯ä»¥æ˜æ˜¾çœ‹åˆ°åŒºåˆ«ï¼š

- `useEffect`çš„æ–¹å—ä¼šé—ªä¸€ä¸‹
- `useLayoutEffect`çš„æ–¹å—åˆ™ä¸ä¼šé—ª

å¦‚æœä½ çš„ç”µè„‘æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œå¯ä»¥å°è¯•å¤šæ¬¡åˆ·æ–°ï¼Œä¹Ÿæœ‰ä¸€å®šå‡ ç‡çœ‹åˆ°`useEffect`çš„é—ªåŠ¨ã€‚

æˆ‘ä»¬åº”è¯¥è¿™æ ·æè¿°äºŒè€…çš„åŒºåˆ«ï¼š

- `useEffect`: æ‰§è¡Œæ—¶æœºæ˜¯åœ¨Reactçš„æ¸²æŸ“å’Œæäº¤é˜¶æ®µä¹‹åã€‚è¿™æ„å‘³ç€å½“ä»»ä½•ç›¸å…³DOMæ›´æ”¹è¢«åº”ç”¨å¹¶ä¸”ç»„ä»¶å·²è¢«é‡æ–°æ¸²æŸ“åï¼Œ`useEffect`é‡Œçš„ä»£ç ä¼šæ‰§è¡Œã€‚ä½†å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥å¯èƒ½ä¼šåœ¨æµè§ˆå™¨çš„ä¸‹ä¸€ä¸ªç»˜åˆ¶å‘¨æœŸä¹‹åæ‰æ‰§è¡Œã€‚
- `useLayoutEffect`: æ‰§è¡Œæ—¶æœºæ˜¯åœ¨Reactçš„æäº¤é˜¶æ®µä¹‹åï¼Œä½†åœ¨æµè§ˆå™¨å®é™…ç»˜åˆ¶å±å¹•ä¹‹å‰ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åŒæ­¥åœ°è¯»å–æˆ–æ›´æ”¹DOMï¼Œç„¶åè®©æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡ç»˜åˆ¶æ—¶ç«‹å³ä½“ç°è¿™äº›æ›´æ”¹ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„é—ªçƒæˆ–å¸ƒå±€è·³åŠ¨ã€‚

## useLayoutEffectçš„ä½œç”¨

æˆ‘ä»¬å·²ç»æ¸…æ¥šäº†`useLayoutEffect`çš„ç‰¹æ€§äº†ï¼Œé‚£ä¹ˆå¯ä»¥çŒœæƒ³ï¼Œ`useLayoutEffect`æ˜¯ä½œç”¨äºè¿™æ ·çš„åœºæ™¯ï¼šéœ€è¦åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰è·å– DOM å…ƒç´ çš„å¤§å°æˆ–ä½ç½®ï¼Œæˆ–è€…åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰ä¿®æ”¹ DOMã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å…¸å‹çš„åœºæ™¯â€”â€”tooltip ç»„ä»¶ã€‚æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ª tooltip ç»„ä»¶ï¼Œåº”ç”¨`useLayoutEffect`æ¥è‡ªé€‚åº”è®¾ç½® tooltip ä½ç½®ã€‚

æˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼šé¼ æ ‡ç§»å…¥ä¸€ä¸ªæŒ‰é’®ï¼Œèƒ½å¤Ÿåˆ¤æ–­ tooltip å±•ç¤ºåŒºåŸŸï¼Œå¦‚æœæŒ‰é’®ä¸Šæ–¹ç©ºé—´è¶³å¤Ÿï¼Œåˆ™æ˜¾ç¤ºåœ¨ä¸Šæ–¹ï¼Œå¦‚æœæŒ‰é’®ä¸Šæ–¹ç©ºé—´ä¸å¤Ÿï¼Œåˆ™è‡ªé€‚åº”æ˜¾ç¤ºåœ¨æŒ‰é’®ä¸‹æ–¹ã€‚

ä¸ºäº†ä¿è¯æ²¡æœ‰é¡µé¢æŠ–åŠ¨ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨`useLayoutEffect`æ¥æ›´æ–°æ˜¾ç¤ºçš„ä½ç½®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```jsx
import React, { useLayoutEffect, useRef, useState } from "react";
import { createPortal } from "react-dom";

export default function HoverTooltip() {
  const containerRef = useRef(null);

  return (
    <div
      ref={containerRef}
      className="p-8 bg-gray-100 w-full rounded-xl mt-5 shadow-lg m-4 space-y-4 overflow-hidden"
    >
      <ButtonWithTooltip
        containerRef={containerRef}
        tooltipContent="This tooltip does not fit above the button. This is why it's displayed below instead!"
      >
        Hover over me (tooltip above)
      </ButtonWithTooltip>
      <ButtonWithTooltip
        containerRef={containerRef}
        tooltipContent="This tooltip fits above the button"
      >
        Hover over me (tooltip below)
      </ButtonWithTooltip>
      <ButtonWithTooltip
        containerRef={containerRef}
        tooltipContent="This tooltip fits above the button"
      >
        Hover over me (tooltip below)
      </ButtonWithTooltip>
    </div>
  );
}

const ButtonWithTooltip = ({ tooltipContent, containerRef, children }) => {
  const [targetRect, setTargetRect] = useState(null);
  const [containerRect, setContainerRect] = useState(null);
  const buttonRef = useRef(null);

  return (
    <div className="relative">
      <button
        ref={buttonRef}
        className="py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-600 active:bg-blue-700 focus:outline-none transition"
        onMouseEnter={() => {
          buttonRef.current &&
            setTargetRect(buttonRef.current.getBoundingClientRect());
          containerRef.current &&
            setContainerRect(containerRef.current.getBoundingClientRect());
        }}
        onMouseLeave={() => setTargetRect(null)}
      >
        {children}
      </button>
      {targetRect && containerRect && (
        <Tooltip targetRect={targetRect} containerRect={containerRect}>
          {tooltipContent}
        </Tooltip>
      )}
    </div>
  );
};

const Tooltip = ({ children, targetRect, containerRect }) => {
  const ref = useRef(null);
  const [tooltipHeight, setTooltipHeight] = useState(0);

  useLayoutEffect(() => {
    if (ref.current) {
      const { height } = ref.current.getBoundingClientRect();
      setTooltipHeight(height); // è®¾ç½®é«˜åº¦
    }
  }, [children]);

  let tooltipX = targetRect.left;
  let tooltipY =
    targetRect.top - containerRect.top - tooltipHeight < 0
      ? targetRect.bottom
      : targetRect.top - tooltipHeight; // è®¡ç®—ä½ç½®

  return createPortal(
    <div
      ref={ref}
      className="absolute bg-gray-700 text-white py-1 px-2 rounded shadow-md"
      style={{
        left: `${tooltipX}px`,
        top: `${tooltipY}px`,
      }}
    >
      {children}
    </div>,
    document.body
  );
};
```

è¿™é‡Œç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å†™äº†ä¸‰ä¸ªæŒ‰é’®ï¼Œæ¯æ¬¡é¼ æ ‡ç§»å…¥æŒ‰é’®çš„æ—¶å€™ï¼Œè®¡ç®—æŒ‰é’®åˆ°çˆ¶çº§ä¸Šæ²¿çš„ç©ºé—´æ˜¯å¦å¯ä»¥å®¹çº³ä¸€ä¸ª tooltipï¼Œå¦‚æœè¶³å¤Ÿï¼Œtooltip å°±åœ¨æŒ‰é’®ä¸Šæ–¹å±•ç¤ºï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™åœ¨æŒ‰é’®ä¸‹æ–¹å±•ç¤ºã€‚å®é™…æ•ˆæœå¦‚å›¾ï¼š

![1.png](/assets/020/1.png)

ä½ ä¹Ÿå¯ä»¥[åˆ°æ¼”ç¤ºç«™](https://nextjs.weijunext.com/hooks/useLayoutEffect)è¯•ä¸€è¯•ã€‚

## æ€»ç»“

æœ€åï¼Œæˆ‘ä»¬å†æ˜ç¡®ä¸€ä¸‹`useEffect`å’Œ`useLayoutEffect`åˆ†åˆ«åœ¨ä½•æ—¶ä½¿ç”¨ã€`useLayoutEffect`çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ã€‚

### **ä½•æ—¶ä½¿ç”¨`useEffect`**

- **å‰¯ä½œç”¨ä¸DOMæ— å…³**ï¼šä¾‹å¦‚ï¼Œæ•°æ®è·å–ã€è®¾ç½®è®¢é˜…ã€æ‰‹åŠ¨æ›´æ”¹æµè§ˆå™¨çš„URLç­‰ã€‚
- **ä¸éœ€è¦ç«‹å³åŒæ­¥è¯»å–æˆ–æ›´æ”¹DOM**ï¼šå¦‚æœä½ ä¸å…³å¿ƒå¯èƒ½çš„å¾®å°å¸ƒå±€è·³åŠ¨æˆ–é—ªçƒï¼Œé‚£ä¹ˆ`useEffect`å°±è¶³å¤Ÿäº†ã€‚
- **æ€§èƒ½è€ƒè™‘**ï¼š`useEffect`é€šå¸¸å¯¹æ€§èƒ½å½±å“è¾ƒå°ï¼Œå› ä¸ºå®ƒä¸ä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“ã€‚

### ä½•æ—¶ä½¿ç”¨`useLayoutEffect`

- **éœ€è¦åŒæ­¥è¯»å–æˆ–æ›´æ”¹DOM**ï¼šä¾‹å¦‚ï¼Œä½ éœ€è¦è¯»å–å…ƒç´ çš„å¤§å°æˆ–ä½ç½®å¹¶åœ¨æ¸²æŸ“å‰è¿›è¡Œè°ƒæ•´ã€‚
- **é˜²æ­¢é—ªçƒ**ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¼‚æ­¥çš„`useEffect`å¯èƒ½ä¼šå¯¼è‡´å¯è§çš„å¸ƒå±€è·³åŠ¨æˆ–é—ªçƒã€‚ä¾‹å¦‚ï¼ŒåŠ¨ç”»çš„å¯åŠ¨æˆ–æŸäº›å¯è§çš„å¿«é€ŸDOMæ›´æ”¹ã€‚
- **æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼šå¦‚æœä½ æ­£åœ¨å°†æ—§çš„ç±»ç»„ä»¶è¿ç§»åˆ°åŠŸèƒ½ç»„ä»¶ï¼Œå¹¶éœ€è¦æ¨¡æ‹Ÿ `componentDidMount`ã€`componentDidUpdate`å’Œ`componentWillUnmount`çš„åŒæ­¥è¡Œä¸ºã€‚

### ä½¿ç”¨æ³¨æ„äº‹é¡¹

- é¿å…è¿‡åº¦ä½¿ç”¨`useLayoutEffect`ï¼Œå› ä¸ºå®ƒæ˜¯åŒæ­¥çš„ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚åªæœ‰å½“ä½ ç¡®å®éœ€è¦åŒæ­¥çš„DOMæ“ä½œæ—¶æ‰ä½¿ç”¨å®ƒã€‚
- å¦‚æœä»£ç åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¸­å‡ºç°é—®é¢˜ï¼Œè€ƒè™‘å›é€€åˆ°`useEffect`ã€‚`useLayoutEffect`åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ä¸ä¼šè¿è¡Œï¼Œå¯èƒ½ä¼šå¼•å‘è­¦å‘Šæˆ–é”™è¯¯ã€‚


## ä¸“æ èµ„æº

ä¸“æ åšå®¢åœ°å€ï¼š[ç²¾è¯»React Hooks](/tag/React)

ä¸“æ æ¼”ç¤ºç«™ï¼š[React Hooks Demos](https://nextjs.weijunext.com/hooks)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)

ä¸“æ æ–‡ç« åˆ—è¡¨ï¼š

[ç²¾è¯»React hooksï¼ˆä¸€ï¼‰ï¼šuseState çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•å’Œè¿›é˜¶æŠ€å·§](/article/react-hook-useState)

[ç²¾è¯»React hooksï¼ˆäºŒï¼‰ï¼šReactçŠ¶æ€ç®¡ç†çš„å¼ºå¤§å·¥å…·â€”â€”useReducer](/article/react-hook-useReducer)

[ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–](/article/react-hook-useContext)

[ç²¾è¯»React hooksï¼ˆå››ï¼‰ï¼šuseRefçš„å¤šç»´ç”¨é€”](/article/react-hook-useRef)

[ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ](/article/react-hook-useEffect)

[ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](/article/react-hook-useLayoutEffect)

[ç²¾è¯»React hooksï¼ˆä¸ƒï¼‰ï¼šç”¨useMemoæ¥å‡å°‘æ€§èƒ½å¼€é”€](/article/react-hook-useMemo)

[ç²¾è¯»React hooksï¼ˆå…«ï¼‰ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦useCallback](/article/react-hook-useCallback)

[ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“](/article/react-hook-useTransition)

[ç²¾è¯»React hooksï¼ˆåï¼‰ï¼šä½¿ç”¨useDeferredValueå»¶è¿ŸçŠ¶æ€æ›´æ–°](/article/react-hook-useDeferredValue)

[ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼](/article/react-hook-useInsertionEffect)

[ç²¾è¯»React hooksï¼ˆåäºŒï¼‰ï¼šä½¿ç”¨useImperativeHandleèƒ½è·å¾—ä»€ä¹ˆèƒ½åŠ›](/article/react-hook-useImperativeHandle)

[ç²¾è¯»React hooksï¼ˆåä¸‰ï¼‰ï¼šä½¿ç”¨useSyncExternalStoreè·å–å®æ—¶æ•°æ®](/article/react-hook-useSyncExternalStore)

[ç²¾è¯»React hooksï¼ˆåå››ï¼‰ï¼šæ€»æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦useIdä¸ºä½ ç”Ÿæˆå”¯ä¸€id](/article/react-hook-useId)

[ç²¾è¯»React hooksï¼ˆåäº”ï¼‰ï¼šæŠŠuseDebugValueåŠ å…¥ä½ çš„Reactè°ƒè¯•å·¥å…·åº“](/article/react-hook-useDebugValue)

[ç²¾è¯»React hooksï¼ˆåå…­ï¼‰ï¼šä¸€ä¸ªä¸ºä»£ç ä¼˜é›…è€Œç”Ÿçš„hookâ€”â€”use](/article/react-hook-use)