---
title: ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“
description: Reactçš„é»˜è®¤æ¸²æŸ“è¡Œä¸ºæ˜¯åŒæ­¥çš„ï¼Œé‡åˆ°å¤§æ•°æ®é‡æ¸²æŸ“æ—¶å°±ä¼šå‡ºç°å¡é¡¿ï¼Œä½¿ç”¨useTransitionå°±å¯ä»¥è½»æ¾æŠŠUIæ¸²æŸ“å˜æˆå¼‚æ­¥çš„ï¼Œè®©å¡é¡¿æ¶ˆå¤±æ— è¸ªã€‚
slug: react-hook-useTransition
slugId: 5458862c-76aa-436e-adc5-269dc82228df
tags: React
date: 2023-09-14
---

ä¼—æ‰€å‘¨çŸ¥ï¼ˆå…¶å®å¾ˆå¤šäººæ²¡æœ‰æ„è¯†åˆ°ï¼‰ï¼ŒReactçš„é»˜è®¤æ¸²æŸ“è¡Œä¸ºæ˜¯åŒæ­¥çš„ï¼ŒReactæ€»æ˜¯åœ¨æˆ‘ä¸€ä¸ªæ“ä½œæˆ–è€…çŠ¶æ€æ›´æ–°åå†æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œæˆ–çŠ¶æ€æ›´æ–°ã€‚åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œè¿™ç§å³æ—¶å“åº”æ˜¯ç†æƒ³çš„ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†UIä¸å†…éƒ¨çŠ¶æ€ä¿æŒç´§å¯†åŒæ­¥ã€‚ä½†åœ¨å¯†é›†æˆ–èµ„æºç¹é‡çš„æ›´æ–°åœºæ™¯ä¸‹â€”â€”å¦‚åŠ è½½å¤§é‡æ•°æ®æ—¶ï¼Œè¿™ç§åŒæ­¥è¡Œä¸ºå¯èƒ½å¯¼è‡´æ•´ä¸ªåº”ç”¨çš„UIå¡é¡¿ç”šè‡³æ²¡æœ‰å“åº”ã€‚æˆ‘ä»¬æŠŠè¿™ç§UIå¡é¡¿ç°è±¡å«åšâ€œé˜»å¡â€ï¼Œå½“ä½ é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œä½ çš„leaderå¾€å¾€ä¼šè®©ä½ è¿›è¡Œç”¨æˆ·ä½“éªŒä¼˜åŒ–ğŸ¶ã€‚

React v18å¼€å§‹ï¼Œå®˜æ–¹å¼•å…¥äº†å¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰å’Œä¸€äº›ç›¸å…³çš„Hooksï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯`useTransition`ã€‚å¼€å‘è€…å¯ä»¥å°†æŸäº›çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºâ€œå¯ä¸­æ–­â€çš„ï¼Œä»è€Œå…è®¸Reactåœ¨å¿…è¦æ—¶æ‰“æ–­è¿™äº›æ›´æ–°ï¼Œå…ˆå¤„ç†å…¶ä»–æ›´ä¸ºç´§æ€¥çš„ä»»åŠ¡ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ¸²æŸ“æ•ˆæœç§°ä½œâ€œéé˜»å¡UIâ€ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥æ¢è®¨`useTransition`çš„å·¥ä½œåŸç†ï¼Œå¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨å®ƒã€‚

## `useTransition`åŸºç¡€

é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç™½`useTransition`çš„è®¾è®¡åˆè¡·ï¼šåœ¨Reactçš„å¹¶å‘æ¨¡å¼ä¸‹ï¼Œå…è®¸æˆ‘ä»¬ä¸­æ–­æˆ–å»¶åæŸäº›çŠ¶æ€æ›´æ–°ï¼Œä»¥ä¾¿äºèƒ½å¤Ÿåœ¨é•¿æ—¶é—´çš„è®¡ç®—æˆ–æ•°æ®æ‹‰å–æ—¶ä¿æŒUIçš„å“åº”æ€§ã€‚

### ç”¨æ³•å®šä¹‰

```jsx
const [isPending, startTransition] = useTransition()
```

- `isPending`ï¼šæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå½“è¿‡æ¸¡çŠ¶æ€ä»åœ¨è¿›è¡Œä¸­æ—¶ï¼Œå…¶å€¼ä¸º`true`ï¼›å¦åˆ™ä¸º`false`ã€‚
- `startTransition`ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“ä½ å¸Œæœ›å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿‡æ¸¡çŠ¶æ€æ—¶è°ƒç”¨å®ƒã€‚

### å·¥ä½œåŸç†

1. **å¹¶å‘æ¨¡å¼ä¸‹çš„çŠ¶æ€æ›´æ–°åˆ†ç±»**:
åœ¨Reactçš„å¹¶å‘æ¨¡å¼ä¸­ï¼Œä¸æ˜¯æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°éƒ½è¢«è§†ä¸ºç­‰åŒçš„ã€‚Reactå°†æ›´æ–°åˆ†ä¸ºä¸åŒçš„ä¼˜å…ˆçº§ç±»åˆ«ï¼Œå…¶ä¸­æŸäº›æ›´æ–°ï¼ˆå¦‚è¾“å…¥å¤„ç†ï¼‰è¢«è®¤ä¸ºæ˜¯æ›´åŠ ç´§æ€¥çš„ï¼Œè€Œå…¶ä»–æ›´æ–°ï¼ˆå¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼‰åˆ™å¯ä»¥ä¸­æ–­æˆ–è€…å»¶åæ›´æ–°ã€‚
2. **ä½¿ç”¨`startTransition`è¿›è¡ŒçŠ¶æ€æ›´æ–°**:
å½“ä½ ä½¿ç”¨`startTransition`å‡½æ•°è¿›è¡ŒçŠ¶æ€æ›´æ–°æ—¶ï¼Œä½ å®é™…ä¸Šå‘Šè¯‰ Reactï¼šè¿™ä¸ªæ›´æ–°ä¸æ˜¯éå¸¸ç´§æ€¥çš„ï¼Œå¦‚æœæœ‰æ›´é‡è¦çš„æ›´æ–°è¦å¤„ç†ï¼Œä½ å¯ä»¥ä¸­æ–­æˆ–å»¶åè¿™ä¸ªæ¬¡è¦æ›´æ–°ã€‚
3. **`isPending`çš„ç”¨é€”**:
`isPending` ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ ‡è¯†ï¼Œå‘Šè¯‰æˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ª`startTransition`æ­£åœ¨æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®`isPending`æ¥è®¾ç½®è¿‡æ¸¡çŠ¶æ€çš„æ ·å¼ã€‚

### ä½¿ç”¨èŒƒå›´å’Œæ³¨æ„äº‹é¡¹

- `useTransition`ä»…åœ¨å¼€å¯Reactå¹¶å‘æ¨¡å¼çš„æ—¶å€™æ‰æœ‰æ•ˆ
    
    ```jsx
    // React v18ä»¥å‰
    ReactDOM.render(<app />, rootNode) // âŒ æ— æ³•å¼€å¯useTransition
    
    // React v18
    ReactDOM.createRoot(rootNode).render(<app />) // âœ… å¼€å¯useTransition
    ```
    
- åªæœ‰å½“ä½ èƒ½è®¿é—®æŸä¸ªçŠ¶æ€çš„`set`å‡½æ•°æ—¶ï¼Œä½ æ‰èƒ½å°†æ›´æ–°åŒ…è£…è¿›`useTransition`ä¸­ã€‚
- ä¼ é€’ç»™`startTransition`çš„å‡½æ•°å¿…é¡»æ˜¯åŒæ­¥çš„ï¼Œè€Œä¸èƒ½æ˜¯å¼‚æ­¥çš„ã€‚
    
    ```jsx
    startTransition(async () => {
      await someAsyncFunction();
      // âŒ Setting state *after* startTransition call
      setPage('/about');
    });
    
    await someAsyncFunction();
    startTransition(() => {
      // âœ… Setting state *during* startTransition call
      setPage('/about');
    });
    ```
    
- å¦‚æœä½ æƒ³æ ¹æ®æŸä¸ª prop æˆ–è‡ªå®šä¹‰ Hook çš„å€¼æ¥å¯åŠ¨ä¸€ä¸ªè¿‡æ¸¡ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°è¯•ä½¿ç”¨`useDeferredValue`ã€‚è¿™æ˜¯ä¸‹ä¸€ç¯‡ä»‹ç»çš„hookï¼Œæ­¤å¤„ä¸å±•å¼€ã€‚
- ä¸èƒ½ç”¨äºæ§åˆ¶æ–‡æœ¬è¾“å…¥ã€‚å› ä¸ºè¾“å…¥æ¡†æ˜¯éœ€è¦å®æ—¶æ›´æ–°çš„ï¼Œå¦‚æœç”¨`useTransition`é™ä½äº†æ¸²æŸ“ä¼˜å…ˆçº§ï¼Œå¯èƒ½é€ æˆè¾“å…¥â€œå¡é¡¿â€ã€‚
- ä¸è¦åœ¨`startTransition`å†…éƒ¨ä½¿ç”¨`setTimeout`ï¼Œå¦‚æœä¸€å®šè¦ç”¨`setTimeout`ï¼Œä½ å¯ä»¥åœ¨`startTransition`å¤–å±‚ä½¿ç”¨
    
    ```jsx
    startTransition(() => {
      // âŒ Setting state *after* startTransition call
      setTimeout(() => {
        setPage('/about');
      }, 1000);
    });
    
    setTimeout(() => {
      startTransition(() => {
        // âœ… Setting state *during* startTransition call
        setPage('/about');
      });
    }, 1000);
    ```
    
- å‰é¢è¯´åˆ°å¾ˆå¤šæ¬¡â€œä¸­æ–­æˆ–å»¶åæ›´æ–°â€ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¸­æ–­ï¼Œä»€ä¹ˆæ—¶å€™å»¶åæ›´æ–°ï¼Ÿæœ€ç®€å•çš„ç†è§£ï¼šè¢«`useTransition`åŒ…è£¹çš„åŒä¸€ä¸ªçŠ¶æ€å¤šæ¬¡æ›´æ–°ï¼Œåªä¼šæ¸²æŸ“æœ€åä¸€ä¸ªï¼Œå‰é¢çš„éƒ½ç®—ä¸­æ–­ï¼ˆä»…UIå±‚é¢ï¼Œå¦‚ï¼šé•¿åˆ—è¡¨å¤šæ¬¡è¯·æ±‚ï¼‰ï¼›ä¸åŒç»„ä»¶è§¦å‘ä¸åŒçŠ¶æ€çš„æ›´æ–°ï¼Œè¢«`useTransition`åŒ…è£¹çš„çŠ¶æ€ä¼˜å…ˆçº§è¾ƒä½ï¼Œè¢«ä¸­æ–­åä¼šç­‰é«˜ä¼˜å…ˆçº§çš„çŠ¶æ€æ›´æ–°å®Œæˆåç»§ç»­æ›´æ–°ï¼ˆå¦‚ï¼šå¤æ‚å›¾è¡¨æ¸²æŸ“è¢«ä¸­æ–­ï¼Œä¼šåœ¨é«˜ä¼˜å…ˆçº§çŠ¶æ€æ›´æ–°åï¼Œç»§ç»­å¤„ç†å›¾è¡¨çš„æ¸²æŸ“ï¼‰ã€‚

### ç¤ºä¾‹

#### æœ‰æ— `useTransition`çš„å¯¹æ¯”

æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œé¡µé¢ä¸Šæœ‰å¤šä¸ªtabï¼Œå…¶ä¸­ä¸€ä¸ªè¯·æ±‚è€—æ—¶è¾ƒé•¿ï¼Œæˆ‘ä»¬å¿«é€Ÿç‚¹å‡»tabåˆ‡æ¢å†…å®¹ï¼Œä½†æ€»æ˜¯ä¼šåœ¨è¯·æ±‚è€—æ—¶çš„tabä¸Šå¡é¡¿ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```jsx
import React, { useState, memo } from 'react';

const TabContainer = () => {
  const [tab, setTab] = useState('about');

	// æ ¸å¿ƒï¼šåˆ‡æ¢é€‰é¡¹å¡
  function selectTab(nextTab) {
    setTab(nextTab);
  }

  return (
    <div>
      <div>
        <TabButton isActive={tab === 'about'} onClick={() => selectTab('about')}>About</TabButton>
        <TabButton isActive={tab === 'posts'} onClick={() => selectTab('posts')}>Posts (slow)</TabButton>
        <TabButton isActive={tab === 'contact'} onClick={() => selectTab('contact')}>Contact</TabButton>
      </div>
      <hr />
      {tab === 'about' && <AboutTab />}
      {tab === 'posts' && <PostsTab />}
      {tab === 'contact' && <ContactTab />}
    </div>
  );
};

const PostsTab = memo(() => {
  let items = [];
  for (let i = 0; i < 500; i++) {
    items.push(<SlowPost key={i} index={i} />);
  }
  return <ul>{items}</ul>;
});

const SlowPost = ({ index }) => {
  let startTime = performance.now();
  while (performance.now() - startTime < 10) { }
  return <li>Post on weijunext.com #{index + 1}</li>;
};

// çœç•¥éå…³é”®ä»£ç 
// â€¦â€¦

export default TabContainer;
```

å¦‚æœæˆ‘ä»¬æƒ³ç”¨`useTransition`ä¿æŒUIçš„å“åº”ï¼Œåªéœ€è¦ç”¨`startTransition`åŒ…è£¹åˆ‡æ¢é€‰é¡¹å¡çš„`set`

```jsx
const [isPending, startTransition] = React.useTransition();

function selectTab(nextTab) {
  startTransition(() => {
    setTab(nextTab);      
  });
}
```

è¿™æ ·æˆ‘ä»¬å¿«é€Ÿåˆ‡æ¢tabï¼Œæ— è®ºç‚¹åˆ°å“ªä¸€ä¸ªtabéƒ½ä¸ä¼šå¡é¡¿ã€‚

#### `useTransition`å’Œ`Suspense`å®ç°è·¯ç”±æµç•…åˆ‡æ¢

å½“ä¸è·¯ç”±ç»“åˆä½¿ç”¨æ—¶ï¼Œ`React.Suspense`å…è®¸æˆ‘ä»¬å»¶è¿Ÿæ¸²æŸ“æ–°çš„è·¯ç”±å†…å®¹ï¼Œç›´åˆ°æ‰€éœ€çš„æ•°æ®è¢«å®Œå…¨åŠ è½½ã€‚è€Œ`useTransition`åˆ™å…è®¸æˆ‘ä»¬å¯æ§åœ°å¼€å§‹è¿™ç§å¯èƒ½å¯¼è‡´UIå˜åŒ–çš„è¿‡æ¸¡â€”â€”å¯¼èˆªåˆ°æ–°é¡µé¢ã€‚

ä¾‹å¦‚è¿™ä¸ªç¤ºä¾‹ï¼š

```jsx
import React, { useState } from 'react';
import { BrowserRouter, Switch, Route, Link } from 'react-router-dom';

const [location, setLocation] = useState(window.location);
const [isPending, startTransition] = React.unstable_useTransition();

// ä½¿ç”¨ startTransition æ¥æ›´æ–° location çŠ¶æ€ï¼Œèƒ½å¤Ÿå»¶è¿Ÿæ˜¾ç¤ºæ–°é¡µé¢çš„å†…å®¹ï¼Œç›´åˆ°æ•°æ®åŠ è½½å®Œæ¯•
function handleNavigation(newLocation) {
  startTransition(() => {
    setLocation(newLocation);
  });
}

function CustomLink({ to, children }) {
  return (
    <a
      href={to}
      onClick={(event) => {
        event.preventDefault();
        handleNavigation(to);
      }}
    >
      {children}
    </a>
  );
}

// ä¸»åº”ç”¨ç»„ä»¶
function App() {
  return (
    <div>
      <BrowserRouter>
        {/* å¯¼èˆª */}
        <nav>
          <CustomLink to="/about">About</CustomLink>
          <CustomLink to="/contact">Contact</CustomLink>
        </nav>

        {/* ä½¿ç”¨ React.Suspense æ¥å¤„ç†ç»„ä»¶çš„æ‡’åŠ è½½ */}
        <React.Suspense fallback={<LoadingIndicator />}>
          <Switch location={location}>
            <Route path="/about" component={AboutPage} />
            <Route path="/contact" component={ContactPage} />
            {/* ...å…¶ä»–è·¯ç”±... */}
          </Switch>
        </React.Suspense>

        {/* ä½¿ç”¨ isPending æ˜¾ç¤ºæˆ–éšè—å…¨å±€åŠ è½½æŒ‡ç¤ºå™¨ */}
        {isPending && <LoadingIndicator />}
      </BrowserRouter>
    </div>
  );
}

export default App;
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜é›…åœ°å¤„ç†è·¯ç”±åˆ‡æ¢ï¼Œå¹¶ç¡®ä¿åœ¨æ•°æ®åŠ è½½æ—¶ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæµç•…çš„ä½“éªŒã€‚

## ç»“è¯­

`useTransition`å¸¦æ¥çš„æ˜¯â€œå¯ä¸­æ–­â€çš„å¼‚æ­¥UIæ¸²æŸ“ï¼Œå½“å®é™…å·¥ä½œä¸­é‡åˆ°å¡é¡¿çš„ç°è±¡ï¼Œä¸å¦¨æƒ³æƒ³æ˜¯å¦èƒ½ç”¨`useTransition`è§£å†³ã€‚


## ä¸“æ èµ„æº

ä¸“æ åšå®¢åœ°å€ï¼š[ç²¾è¯»React Hooks](/tag/React)

ä¸“æ æ¼”ç¤ºç«™ï¼š[React Hooks Demos](https://nextjs.weijunext.com/hooks)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)

ä¸“æ æ–‡ç« åˆ—è¡¨ï¼š

[ç²¾è¯»React hooksï¼ˆä¸€ï¼‰ï¼šuseState çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•å’Œè¿›é˜¶æŠ€å·§](/article/react-hook-useState)

[ç²¾è¯»React hooksï¼ˆäºŒï¼‰ï¼šReactçŠ¶æ€ç®¡ç†çš„å¼ºå¤§å·¥å…·â€”â€”useReducer](/article/react-hook-useReducer)

[ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–](/article/react-hook-useContext)

[ç²¾è¯»React hooksï¼ˆå››ï¼‰ï¼šuseRefçš„å¤šç»´ç”¨é€”](/article/react-hook-useRef)

[ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ](/article/react-hook-useEffect)

[ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](/article/react-hook-useLayoutEffect)

[ç²¾è¯»React hooksï¼ˆä¸ƒï¼‰ï¼šç”¨useMemoæ¥å‡å°‘æ€§èƒ½å¼€é”€](/article/react-hook-useMemo)

[ç²¾è¯»React hooksï¼ˆå…«ï¼‰ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦useCallback](/article/react-hook-useCallback)

[ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“](/article/react-hook-useTransition)

[ç²¾è¯»React hooksï¼ˆåï¼‰ï¼šä½¿ç”¨useDeferredValueå»¶è¿ŸçŠ¶æ€æ›´æ–°](/article/react-hook-useDeferredValue)

[ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼](/article/react-hook-useInsertionEffect)

[ç²¾è¯»React hooksï¼ˆåäºŒï¼‰ï¼šä½¿ç”¨useImperativeHandleèƒ½è·å¾—ä»€ä¹ˆèƒ½åŠ›](/article/react-hook-useImperativeHandle)

[ç²¾è¯»React hooksï¼ˆåä¸‰ï¼‰ï¼šä½¿ç”¨useSyncExternalStoreè·å–å®æ—¶æ•°æ®](/article/react-hook-useSyncExternalStore)

[ç²¾è¯»React hooksï¼ˆåå››ï¼‰ï¼šæ€»æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦useIdä¸ºä½ ç”Ÿæˆå”¯ä¸€id](/article/react-hook-useId)

[ç²¾è¯»React hooksï¼ˆåäº”ï¼‰ï¼šæŠŠuseDebugValueåŠ å…¥ä½ çš„Reactè°ƒè¯•å·¥å…·åº“](/article/react-hook-useDebugValue)

[ç²¾è¯»React hooksï¼ˆåå…­ï¼‰ï¼šä¸€ä¸ªä¸ºä»£ç ä¼˜é›…è€Œç”Ÿçš„hookâ€”â€”use](/article/react-hook-use)