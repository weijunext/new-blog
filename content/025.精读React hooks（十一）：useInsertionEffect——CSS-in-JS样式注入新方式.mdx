---
title: ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼
description: useInsertionEffectæ˜¯ä¸ºCSS-in-JSåº“æä¾›çš„ä¸€ä¸ªhookï¼Œå®ƒè®©åè€…å¯ä»¥æ›´åˆç†åœ°æ³¨å…¥æ ·å¼ï¼Œæœ¬æ–‡å°±æ¥ä»‹ç»ä¸€ä¸‹useInsertionEffectçš„ç”¨æ³•å’Œä¼˜åŠ¿ã€‚
slug: react-hook-useInsertionEffect
slugId: ab3037b7-c0b6-4335-a869-431553a6b644
tags: React
date: 2023-09-16
---

Reactå‘å±•è‡³ä»Šï¼Œå·²ç»ä¸å±€é™äºå‰ç«¯å¼€å‘æ¡†æ¶çš„å®šä½ï¼Œå®ƒå·²ç»é€æ¸å‘å±•æˆæ¡†æ¶çš„æ¡†æ¶ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºReactè¿™å‡ å¹´æ¨å‡ºäº†å¾ˆå¤šæœåŠ¡äºä¸Šå±‚æ¡†æ¶çš„APIï¼Œè¿™ç±»APIæ™®é€šå¼€å‘è€…ä¸€èˆ¬ä¸éœ€è¦å…³æ³¨ã€‚åœ¨React hooksé‡Œï¼Œ`useInsertionEffect`å°±æ˜¯è¿™æ ·çš„å®šä½â€”â€”`useInsertionEffect`æ˜¯ä¸ºCSS-in-JSåº“æä¾›çš„ä¸€ä¸ªhookï¼Œå®ƒè®©åè€…å¯ä»¥æ›´åˆç†åœ°æ³¨å…¥æ ·å¼ï¼Œæ™®é€šå¼€å‘è€…å¯ä»¥ä¸ç”¨å…³æ³¨`useInsertionEffect`ã€‚

## `useInsertionEffect`èƒ½ä¸ºCSS-in-JSå¸¦æ¥ä»€ä¹ˆï¼Ÿ

åœ¨`useInsertionEffect`å‡ºç°ä»¥å‰ï¼Œæ— è®ºæ˜¯ä½¿ç”¨`useEffect`æ³¨å…¥è¿˜æ˜¯`useLayoutEffect`æ³¨å…¥ï¼Œéƒ½å­˜åœ¨é‡å¤è®¡ç®—å’Œæ€§èƒ½æµªè´¹çš„é—®é¢˜ï¼Œè€Œåƒ`styled-components`ä½¿ç”¨babelæ’ä»¶åˆ™åˆæ˜¾å¾—ä¸å¤Ÿçµæ´»ã€‚

ä¸ºäº†å¼¥è¡¥è¿™äº›ä¸»æµæ–¹æ¡ˆçš„ä¸è¶³ï¼ŒReactç”¨`useInsertionEffect`ç»™CSS-in-JSåº“ä½œè€…å¤šä¸€ä¸ªé€‰æ‹©ï¼Œ`useInsertionEffect`æœ‰è¿™æ ·çš„ä¼˜ç‚¹ï¼š

1. **åŠ¨æ€æ€§**ï¼šå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ³¨å…¥æ ·å¼ï¼Œè¿™ä½¿å¾—åŸºäºç»„ä»¶çš„çŠ¶æ€ã€é“å…·æˆ–ä¸Šä¸‹æ–‡çš„æ ·å¼å˜åŒ–å˜å¾—å®¹æ˜“ã€‚
2. **åŠæ—¶æ³¨å…¥**ï¼šä¿è¯äº†åœ¨ä»»ä½•å¸ƒå±€æ•ˆæœè§¦å‘ä¹‹å‰æ’å…¥æ ·å¼ï¼Œå‡å°‘äº†æ ·å¼çš„é‡å¤è®¡ç®—å’Œå¸ƒå±€æŠ–åŠ¨ã€‚

æ€»ç»“æ¥è¯´ï¼Œå†é«˜åº¦åŠ¨æ€æ ·å¼çš„åº”ç”¨ä¸­ï¼Œ`useInsertionEffect`çš„è¡¨ç°ä¼šæ¯”å…¶å®ƒæ–¹æ¡ˆæ›´ä¼˜ç§€ã€‚

## `useInsertionEffect`åŸºæœ¬ä½¿ç”¨

è¿™æ˜¯åŸºç¡€ç”¨æ³•çš„å®šä¹‰ï¼š

```
useInsertionEffect(setup, dependencies?)
```

åœ¨`setup`æ–¹æ³•é‡Œå¯ä»¥åšæˆ‘ä»¬éœ€è¦çš„å¤„ç†ï¼Œ`dependencies`åˆ™æ˜¯ä¾èµ–æ•°ç»„ï¼Œå’Œ`useEffect`ã€`useLayoutEffect`çš„ä¾èµ–æ•°ç»„è§„åˆ™ä¸€æ ·ã€‚

ç°åœ¨æ¥çœ‹ä¸ªè¯¦ç»†çš„ç”¨æ³•ç¤ºä¾‹ï¼š

```
import { useInsertionEffect } from 'react';

function useDynamicStyle(styleObj) {
  const cssString = convertStyleObjToCSS(styleObj); // å°†æ ·å¼å¯¹è±¡è½¬æ¢ä¸º CSS å­—ç¬¦ä¸²çš„è¾…åŠ©å‡½æ•°

  useInsertionEffect(() => {
    const styleElement = document.createElement('style');
    styleElement.innerHTML = cssString;
    document.head.appendChild(styleElement);
    return () => {
      document.head.removeChild(styleElement);
    };
  }, [cssString]);
}
```

åœ¨`useInsertionEffect`é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€æ³¨å…¥`<style>`ã€‚

## æ³¨æ„äº‹é¡¹

- `useInsertionEffect`åªåœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œä¸èƒ½åœ¨æœåŠ¡å™¨æ¸²æŸ“æœŸé—´è¿è¡Œã€‚
- ä¸èƒ½ä»`useInsertionEffect`ä¸­æ›´æ–°çŠ¶æ€ã€‚è¿™æ˜¯å› ä¸º`useInsertionEffect`ä¸“ä¸ºæ’å…¥æ“ä½œè®¾è®¡çš„ï¼Œè€Œä¸æ˜¯ä¸ºå“åº”å¼çŠ¶æ€å˜åŒ–è®¾è®¡çš„ã€‚å¦‚æœåœ¨`useInsertionEffect`é‡Œæ›´æ–°çŠ¶æ€ï¼Œä¼šé€ æˆç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
- å½“`useInsertionEffect`è¿è¡Œæ—¶ï¼Œrefsè¿˜æ²¡æœ‰é™„åŠ ã€‚å¦‚æœä½ è¯•å›¾åœ¨`useInsertionEffect`ä¸­è®¿é—®refï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°`null`æˆ–æœªå®šä¹‰çš„å€¼ã€‚
- `useInsertionEffect`å¯èƒ½åœ¨DOMæ›´æ–°ä¹‹å‰æˆ–ä¹‹åè¿è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ä¾èµ–äºDOMåœ¨ç‰¹å®šæ—¶åˆ»çš„æ›´æ–°çŠ¶æ€ã€‚è¿™æ˜¯å› ä¸º`useInsertionEffect`çš„è®¾è®¡åˆè¡·æ˜¯åœ¨ä»»ä½•å¸ƒå±€æ•ˆæœè§¦å‘ä¹‹å‰æ’å…¥å…ƒç´ ï¼Œä½†å®ƒå¹¶ä¸ä¿è¯åœ¨ DOM çš„ä»»ä½•ç‰¹å®šæ›´æ–°ä¹‹å‰æˆ–ä¹‹åè¿è¡Œã€‚å› æ­¤ï¼Œä¾èµ–äºDOMåœ¨ç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€å¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼šå‡è®¾ä½ å¸Œæœ›åœ¨`useInsertionEffect`ä¸­æ£€æŸ¥æŸä¸ªå…ƒç´ çš„å°ºå¯¸ã€‚ä½†ç”±äº DOM å¯èƒ½å°šæœªæ›´æ–°ï¼Œæ‰€ä»¥ä½ å¾—åˆ°çš„å°ºå¯¸å¯èƒ½æ˜¯æ—§çš„æˆ–ä¸å‡†ç¡®çš„ã€‚

## ç»“è¯­

è™½ç„¶`useInsertionEffect`æ˜¯ä¸ºCSS-in-JSåº“æä¾›çš„ï¼Œä½†ä½œä¸ºä¸€åæƒ³äº†è§£Reactç”Ÿæ€çš„å¼€å‘è€…ï¼Œå³ä½¿å·¥ä½œä¸­ç”¨ä¸åˆ°`useInsertionEffect`ï¼ŒæŒæ¡ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ä¹Ÿæ˜¯æœ‰åˆ©æ— å®³ã€‚


## ä¸“æ èµ„æº

ä¸“æ åšå®¢åœ°å€ï¼š[ç²¾è¯»React Hooks](/tag/React)

ä¸“æ æ¼”ç¤ºç«™ï¼š[React Hooks Demos](https://nextjs.weijunext.com/hooks)

ä¸“æ æºç ä»“åº“ï¼šğŸ‘‰[Github - Source Code](https://github.com/weijunext/nextjs-learn-demos)

äº¤ä¸ªæœ‹å‹ï¼šğŸ‘‰[åŠ å…¥ã€Œç‹¬ç«‹å…¨æ ˆäº¤æµç¾¤ã€](/make-a-friend)

ä¸“æ æ–‡ç« åˆ—è¡¨ï¼š

[ç²¾è¯»React hooksï¼ˆä¸€ï¼‰ï¼šuseState çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•å’Œè¿›é˜¶æŠ€å·§](/article/react-hook-useState)

[ç²¾è¯»React hooksï¼ˆäºŒï¼‰ï¼šReactçŠ¶æ€ç®¡ç†çš„å¼ºå¤§å·¥å…·â€”â€”useReducer](/article/react-hook-useReducer)

[ç²¾è¯»React hooksï¼ˆä¸‰ï¼‰ï¼šuseContextä»åŸºç¡€åº”ç”¨åˆ°æ€§èƒ½ä¼˜åŒ–](/article/react-hook-useContext)

[ç²¾è¯»React hooksï¼ˆå››ï¼‰ï¼šuseRefçš„å¤šç»´ç”¨é€”](/article/react-hook-useRef)

[ç²¾è¯»React hooksï¼ˆäº”ï¼‰ï¼šuseEffectä½¿ç”¨ç»†èŠ‚çŸ¥å¤šå°‘ï¼Ÿ](/article/react-hook-useEffect)

[ç²¾è¯»React hooksï¼ˆå…­ï¼‰ï¼šuseLayoutEffectè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](/article/react-hook-useLayoutEffect)

[ç²¾è¯»React hooksï¼ˆä¸ƒï¼‰ï¼šç”¨useMemoæ¥å‡å°‘æ€§èƒ½å¼€é”€](/article/react-hook-useMemo)

[ç²¾è¯»React hooksï¼ˆå…«ï¼‰ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦useCallback](/article/react-hook-useCallback)

[ç²¾è¯»React hooksï¼ˆä¹ï¼‰ï¼šä½¿ç”¨useTransitionè¿›è¡Œéé˜»å¡æ¸²æŸ“](/article/react-hook-useTransition)

[ç²¾è¯»React hooksï¼ˆåï¼‰ï¼šä½¿ç”¨useDeferredValueå»¶è¿ŸçŠ¶æ€æ›´æ–°](/article/react-hook-useDeferredValue)

[ç²¾è¯»React hooksï¼ˆåä¸€ï¼‰ï¼šuseInsertionEffectâ€”â€”CSS-in-JSæ ·å¼æ³¨å…¥æ–°æ–¹å¼](/article/react-hook-useInsertionEffect)

[ç²¾è¯»React hooksï¼ˆåäºŒï¼‰ï¼šä½¿ç”¨useImperativeHandleèƒ½è·å¾—ä»€ä¹ˆèƒ½åŠ›](/article/react-hook-useImperativeHandle)

[ç²¾è¯»React hooksï¼ˆåä¸‰ï¼‰ï¼šä½¿ç”¨useSyncExternalStoreè·å–å®æ—¶æ•°æ®](/article/react-hook-useSyncExternalStore)

[ç²¾è¯»React hooksï¼ˆåå››ï¼‰ï¼šæ€»æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦useIdä¸ºä½ ç”Ÿæˆå”¯ä¸€id](/article/react-hook-useId)

[ç²¾è¯»React hooksï¼ˆåäº”ï¼‰ï¼šæŠŠuseDebugValueåŠ å…¥ä½ çš„Reactè°ƒè¯•å·¥å…·åº“](/article/react-hook-useDebugValue)

[ç²¾è¯»React hooksï¼ˆåå…­ï¼‰ï¼šä¸€ä¸ªä¸ºä»£ç ä¼˜é›…è€Œç”Ÿçš„hookâ€”â€”use](/article/react-hook-use)