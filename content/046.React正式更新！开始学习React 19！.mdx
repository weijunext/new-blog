---
title: Reactæ­£å¼æ›´æ–°ï¼å¼€å§‹å­¦ä¹ React 19ï¼
description: 2024å¹´4æœˆï¼ŒReact 19çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒï¼Œç‰ˆæœ¬å·æ˜¯19.0.0-Betaï¼Œå¿«æ¥æŠ¢å…ˆå­¦ä¹ æ–°ç‰¹æ€§ã€‚
slug: react-v19-beta
tags: React
date: 2024-04-28
pin: pin
---

ä»Šå¹´2æœˆä»½ï¼ŒReact å‘å¸ƒæ¶ˆæ¯ç¡®è®¤ä»Šå¹´å‘å¸ƒ v19 ç‰ˆæœ¬ï¼Œå°˜å°ä¸¤å¹´çš„ç‰ˆæœ¬å·ç»ˆäºè¦æ›´æ–°äº†ï¼ˆè¯¦æƒ…ç‚¹å‡»ï¼š[React 19 å‘å¸ƒåœ¨å³ï¼ŒæŠ¢å…ˆå­¦ä¹ ä¸€ä¸‹æ–°ç‰¹æ€§](/article/react-v19-preview)ï¼‰ã€‚é‚£æ—¶å€™ï¼ŒReact æˆå‘˜ **Andrew Clark**Â æ˜ç¡®äº†æ–°ç‰ˆæœ¬å°†åœ¨3æœˆæˆ–4æœˆå‘å¸ƒã€‚

è¦ä¸æ€ä¹ˆè¯´ã€ŒDDLæ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ã€ï¼Œè¿™ä¸4æœˆåº•äº†ï¼Œæ–°ç‰ˆæœ¬å°±è¸©ç‚¹å‘å¸ƒäº†ã€‚è¿™æ¬¡å‘å¸ƒçš„ç‰ˆæœ¬å·æ˜¯19.0.0-Betaã€‚

è™½ç„¶åªæ˜¯ Beta ç‰ˆï¼Œä½†ä¹Ÿå¤Ÿè®©ç¤¾åŒºå…´å¥‹äº†ï¼š

**Dan** è¯´ã€Œthey did whatã€

**Andrew Clark** è¯´ã€ŒReact 19: Never forwardRef againã€

**Josh W. Comeau** è¯´ã€ŒLots of nice quality-of-life improvements here!ã€

å”¯ä¸€çš„é—æ†¾æ˜¯ï¼Œç» React æˆå‘˜ lauren ç¡®è®¤ï¼ŒReact Compiler åˆè·³ç¥¨äº†ã€‚è¿™ä¸ªä¸œè¥¿åŸæ¥çš„åç§°å«åšã€ŒReact Forgetã€ï¼ŒçœŸå°±æ˜¯ Forget å±æ€§æ‹‰æ»¡äº†ã€‚

æ€»ç»“ä¸€ä¸‹ 19.0.0-Beta ç‰ˆæœ¬çš„å‘å¸ƒçš„ç‰¹æ€§å°±æ˜¯ï¼š

1. ä¸€ä¸ª Actions
2. ä¸‰ä¸ªæ–° hook
3. ä¸€ä¸ªæ–° API
4. ref å’Œ context ç”¨æ³•æ›´æ–¹ä¾¿
5. å…¶ä»–æ”¯æ’‘ç±»æ›´æ–°ã€æœåŠ¡ç«¯èƒ½åŠ›æ›´æ–°

æ¥ä¸‹æ¥æœ¬æ–‡ä¸€ä¸ªä¸ªä»‹ç»ã€‚

<Aside>
æ¬¢è¿åŠ å…¥ã€ŒğŸŒ[ç‹¬ç«‹å…¨æ ˆå¼€å‘äº¤æµç¾¤](/make-a-friend)ã€ï¼Œä¸€èµ·å­¦ä¹ äº¤æµå‰ç«¯å’ŒNodeæŠ€æœ¯

</Aside>

## Actions

Actions ä¸æ˜¯ä¸€ä¸ª APIï¼Œæ˜¯ä¸€ç§ç®€åŒ–è¯·æ±‚æ•°æ®å¤„ç†çš„æ–¹æ³•ç»Ÿç§°ã€‚ä¸€ä¸ªåˆæ ¼çš„ Actions è¦èƒ½å¤Ÿç®€åŒ–å¼‚æ­¥æ“ä½œï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œä¸æ˜¯çŠ¶æ€ç®¡ç†ã€‚

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£Actionsçš„ä½œç”¨ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¡¨å•ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥è¡¨å•æ›´æ–°ä»–ä»¬çš„å§“åã€‚ä»¥å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨useStateæ¥æ‰‹åŠ¨ç®¡ç†è¡¨å•çŠ¶æ€ã€é”™è¯¯çŠ¶æ€å’Œæäº¤çŠ¶æ€ï¼Œä»£ç å¯èƒ½ä¼šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```tsx
function UpdateName() {
  const [name, setName] = useState("");
  const [error, setError] = useState(null);
  const [isPending, setIsPending] = useState(false);

  const handleSubmit = async () => {
    setIsPending(true);
    const error = await updateName(name);
    setIsPending(false);
    if (error) {
      setError(error);
      return;
    } 
    redirect("/path");
  };

  return (
    <div>
      <input value={name} onChange={(event) => setName(event.target.value)} />
      <button onClick={handleSubmit} disabled={isPending}>
        Update
      </button>
      {error && <p>{error}</p>}
    </div>
  );
}
```

è¿™æ®µä»£ç éœ€è¦æ‰‹åŠ¨å¤„ç†è®¸å¤šç»†èŠ‚ã€‚ä½†æ˜¯ï¼Œæœ‰äº† React 19 çš„ Actionsï¼Œæƒ…å†µå°±æœ‰æ‰€ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `useTransition` hook æ¥å¤„ç†è¡¨å•æäº¤ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç† pending çŠ¶æ€ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´ï¼š

```tsx
function UpdateName() {
  const [name, setName] = useState("");
  const [error, setError] = useState(null);
  const [isPending, startTransition] = useTransition();

  const handleSubmit = async () => {
    startTransition(async () => {
      const error = await updateName(name);
      if (error) {
        setError(error);
        return;
      } 
      redirect("/path");
    })
  };

  return (
    <div>
      <input value={name} onChange={(event) => setName(event.target.value)} />
      <button onClick={handleSubmit} disabled={isPending}>
        Update
      </button>
      {error && <p>{error}</p>}
    </div>
  );
}
```

åœ¨ `handleSubmit` å‡½æ•°ä¸­ï¼Œå¼‚æ­¥è¯·æ±‚çš„é€»è¾‘è¢«æ”¾å…¥ `startTransition` çš„å›è°ƒä¸­ã€‚`startTransition` è¢«è°ƒç”¨æ—¶ï¼ŒReact ä¼šç«‹å³å°† `isPending` è®¾ä¸º trueï¼Œè¡¨ç¤ºè¿‡æ¸¡ï¼ˆè¯·æ±‚ï¼‰æ­£åœ¨è¿›è¡Œã€‚ç„¶å React ä¼šåœ¨åå°æ‰§è¡Œ `startTransition` çš„å›è°ƒå‡½æ•°ï¼Œå‘é€å¼‚æ­¥è¯·æ±‚ã€‚åœ¨è¯·æ±‚å®Œæˆåï¼ŒReact ä¼šè‡ªåŠ¨å°† `isPending` åˆ‡æ¢ä¸º falseã€‚

æˆ‘ä»¬åªè¦å°† `isPending` ç»‘å®šåˆ°æäº¤æŒ‰é’®çš„ `disabled` å±æ€§ï¼Œè¿™æ ·åœ¨è¯·æ±‚è¿›è¡ŒæœŸé—´æŒ‰é’®ä¼šè‡ªåŠ¨è¿›å…¥ç¦ç”¨çŠ¶æ€ï¼Œé¿å…ç”¨æˆ·é‡å¤æäº¤ã€‚

ä¸‹é¢æ€»ç»“ä¸€ä¸‹ React å¯¹ Actions çš„çº¦å®šå’Œè¯´æ˜ï¼š

- **å‘½åçº¦å®š**ï¼šä½¿ç”¨å¼‚æ­¥è¿‡æ¸¡çš„å‡½æ•°å¯ä»¥è¢«ç§°ä¸ºâ€œActionsâ€ã€‚
- **æŒ‚èµ·çŠ¶æ€**ï¼šActions è‡ªåŠ¨ç®¡ç†æäº¤æ•°æ®çš„æŒ‚èµ·çŠ¶æ€ã€‚å½“å‘èµ·è¯·æ±‚æ—¶ï¼ŒæŒ‚èµ·çŠ¶æ€ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œå½“æœ€ç»ˆçŠ¶æ€æ›´æ–°åï¼ŒæŒ‚èµ·çŠ¶æ€å°±ä¼šè‡ªåŠ¨é‡ç½®ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·åœ¨ç­‰å¾…æ•°æ®æäº¤æ—¶èƒ½å¤Ÿè·å¾—åé¦ˆï¼ŒåŒæ—¶åœ¨è¯·æ±‚å®Œæˆåæ¸…é™¤æŒ‚èµ·çŠ¶æ€ã€‚
- **ä¹è§‚æ›´æ–°**ï¼šActions æ”¯æŒä¹è§‚æ›´æ–°ï¼Œå³åœ¨ç­‰å¾…è¯·æ±‚æäº¤æ—¶å°±å‘ç”¨æˆ·æ˜¾ç¤ºæ­£ç¡®çš„æäº¤ç»“æœã€‚å¦‚æœæœ€ç»ˆè¯·æ±‚å¤±è´¥ï¼Œä¹è§‚æ›´æ–°ä¼šè‡ªåŠ¨æ¢å¤åˆ°å…¶åŸå§‹å€¼ã€‚
- **é”™è¯¯å¤„ç†**ï¼šActions æä¾›äº†å†…ç½®çš„é”™è¯¯å¤„ç†åŠŸèƒ½ã€‚å½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚
- **è¡¨å•æ”¯æŒ**ï¼š`<form>` å…ƒç´ ç°åœ¨æ”¯æŒå°†å‡½æ•°ä¼ é€’ç»™ `action` å’Œ `formAction` å±æ€§ã€‚é€šè¿‡å°†å‡½æ•°ä¼ é€’ç»™ `action` å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ Actions æ¥å¤„ç†è¡¨å•æäº¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨æäº¤åè‡ªåŠ¨é‡ç½®è¡¨å•ã€‚è¿™ç®€åŒ–äº†è¡¨å•å¤„ç†çš„è¿‡ç¨‹ï¼Œä½¿å…¶æ›´åŠ ç›´è§‚å’Œé«˜æ•ˆã€‚

## ä¸‰ä¸ªæ–° Hook

ä¸ºä»€ä¹ˆè¦å…ˆä»‹ç» Actions å‘¢ï¼Ÿå› ä¸º React 19 åœ¨ Actions åŸºç¡€ä¸Šå¼•å…¥äº†ä¸‰ä¸ªæ–° Hookï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯ä¸ºäº†ç®€åŒ–å¼€å‘è€…æ“ä½œçŠ¶æ€çš„å¤æ‚åº¦ã€‚

### useOptimistic

`useOptimistic`Â çš„ä¸»è¦ç›®çš„æ˜¯è®©æˆ‘ä»¬å¯ä»¥åœ¨ç­‰å¾…å¼‚æ­¥æ“ä½œç»“æœçš„æ—¶å€™ï¼Œå…ˆå‡è®¾æ“ä½œæˆåŠŸå¹¶æ›´æ–°çŠ¶æ€ï¼Œç„¶åå†æ ¹æ®å®é™…ç»“æœæ¥ç¡®è®¤çŠ¶æ€ã€‚

å®ƒçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```tsx
import { useOptimistic } from 'react';

function AppContainer() {
  const [optimisticState, addOptimistic] = useOptimistic(
    state,
    // updateFn
    (currentState, optimisticValue) => {
      // merge and return new state
      // with optimistic value
    }
  );
}
```

å…¶ä¸­ï¼š

- `state`: åˆå§‹çŠ¶æ€å’Œæ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œæ—¶è¿”å›çš„çŠ¶æ€ã€‚
- `updateFn(currentState, optimisticValue)`: ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥å—å½“å‰çŠ¶æ€å’ŒÂ `addOptimistic`Â ä¼ å…¥çš„ä¹è§‚æ›´æ–°å€¼ï¼Œè¿”å›åˆå¹¶åçš„ä¹è§‚çŠ¶æ€ã€‚
- `optimisticState`: ä¹è§‚çŠ¶æ€,å¦‚æœæ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼Œåˆ™ç­‰äºÂ `state`ï¼Œå¦åˆ™ç­‰äºÂ `updateFn`Â çš„è¿”å›å€¼ã€‚
- `addOptimistic`: ä¸€ä¸ªç”¨äºè§¦å‘ä¹è§‚æ›´æ–°çš„å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªä»»æ„ç±»å‹çš„Â `optimisticValue`Â å‚æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™Â `updateFn`ã€‚

`useOptimistic` çš„ä½¿ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚ï¼šè¡¨å•æäº¤ã€ç‚¹èµã€æ”¶è—ã€åˆ é™¤ç­‰éœ€è¦å³æ—¶åé¦ˆçš„åœºæ™¯å‡é€‚ç”¨ã€‚

è¿™æ˜¯ä¸€ä¸ªåˆ é™¤æ•°æ®ä¹è§‚æ›´æ–°çš„ä¾‹å­ï¼š

```tsx
import React, { useState } from 'react';
import { useOptimistic } from 'react';

function AppContainer() {
	// é»˜è®¤æ•°æ®
  const [state, setState] = useState([
    { id: 1, name: 'Item 1' },
    { id: 2, name: 'Item 2' },
    { id: 3, name: 'Item 3' },
  ]);

	// å®šä¹‰æ›´æ–°å‡½æ•°ï¼Œè¯¥å‡½æ•°åŸºäºå½“å‰çŠ¶æ€å’Œä¹è§‚å€¼ï¼ˆè¦åˆ é™¤çš„æ¡ç›®çš„IDï¼‰æ¥æ›´æ–°çŠ¶æ€
  const updateFn = (currentState, optimisticId) => {
    return currentState.filter(item => item.id !== optimisticId);
  };

  const [optimisticState, addOptimistic] = useOptimistic(state, updateFn);

	// åˆ é™¤item
  const deleteItem = async (itemId) => {
    // é¦–å…ˆä¹è§‚åœ°æ›´æ–° UI
    addOptimistic(itemId);

    // æ¨¡æ‹Ÿ API è¯·æ±‚å»¶è¿Ÿ
    setTimeout(() => {
      // å‡è®¾è¿™é‡Œæ˜¯ API åˆ é™¤è°ƒç”¨ï¼Œå®Œæˆåæ›´æ–°å®é™…çŠ¶æ€
      setItems(currentItems => currentItems.filter(item => item.id !== itemId));
    }, 2000);
  };

  return (
    <div>
      <h1>Optimistically Deleting Items</h1>
      <ul>
        {optimisticState.map(item => (
          <li key={item.id}>
            {item.name} <button onClick={() => deleteItem(item.id)}>Delete</button>
          </li>
        ))}
      </ul>
    </div>
  );
}

export default AppContainer;
```

### useActionState

`useActionState` åŸåå«åš `useFormState`ï¼Œ19ç‰ˆæœ¬å¯ç”¨æ–°åç§°ï¼Œè¿”å›å‚æ•°ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼ˆå¥‡æ€ªçš„æ˜¯ï¼ŒReact è¿˜æœªæ›´æ–° `useActionState` çš„æ–‡æ¡£ï¼Œæ¬ºè´Ÿç¨‹åºå‘˜ä¸çœ‹æ–‡æ¡£å—ï¼ŸğŸ¶ï¼‰ã€‚

![1.png](/assets/046/1.png)

è¿™æ˜¯ useActionState çš„æœ€æ–°åŸºæœ¬ç”¨æ³•ï¼š

```tsx
const [state, actionï¼Œ pending] = useActionState(fn, initialState, permalink?);
```

å…¶ä¸­è¿”å›å‚æ•°æœ‰ï¼š

- `state`: è¡¨ç¤ºå½“å‰çš„çŠ¶æ€ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œå®ƒç­‰äºåˆå§‹çŠ¶æ€ `initialState`ã€‚åœ¨æ‰§è¡Œæ“ä½œåï¼Œå®ƒå°†æ˜¯æœ€æ–°ç»“æœã€‚
- `action`: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œæ“ä½œã€‚å½“è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒå°†è§¦å‘ `fn` å‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶æ›´æ–°çŠ¶æ€ã€‚
- `pending`: è¿™æ˜¯æ–°å¢å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ­£åœ¨æ‰§è¡Œæ“ä½œï¼Œåˆ™ä¸º `true`ï¼Œå¦åˆ™ä¸º `false`ã€‚

ä¼ å…¥çš„å‚æ•°æœ‰ï¼š

- `fn`ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œactionè¢«è°ƒç”¨æ—¶ä¼šè§¦å‘ï¼Œéšåè¿”å›æ–°çš„å€¼ã€‚
- `initialState`ï¼šè¿™æ˜¯åˆå§‹å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆå€¼ï¼Œè¦è®¾ç½®ä¸ºnullã€‚
- `permalink`ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œé€šå¸¸ä¸server actionä¸€èµ·ä½¿ç”¨ã€‚

ä¸‹é¢æ˜¯ `useActionState` ä¸ form action ä¸€èµ·ä½¿ç”¨çš„ä¾‹å­ï¼Œå®ç°äº†æ›´æ–°åç§°çš„åŠŸèƒ½ï¼Œå¦‚æœæ›´æ–°å¤±è´¥ï¼Œé¡µé¢ä¸Šæ˜¾ç¤º errorï¼Œå¦‚æœæ›´æ–°æˆåŠŸï¼Œè·³è½¬åˆ°æ›´æ–°åçš„é¡µé¢ï¼š

```tsx
import { useActionState } from 'react';

function ChangeName({ name, setName }) {
  // ä½¿ç”¨ useActionState åˆ›å»ºä¸è¡¨å•æ“ä½œç›¸å…³è”çš„çŠ¶æ€
  const [error, submitAction, isPending] = useActionState(
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¡¨å•æ“ä½œå‡½æ•°
    async (previousState, formData) => {
      // åœ¨æ­¤å®šä¹‰è¡¨å•æ“ä½œçš„é€»è¾‘
      // è¿™ä¸ªå‡½æ•°ä¼šåœ¨è¡¨å•æäº¤æ—¶è¢«è°ƒç”¨
      // å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š
      // - previousState: å‰ä¸€ä¸ªçŠ¶æ€ï¼Œåˆå§‹ä¸º nullï¼Œä¹‹åä¸ºä¸Šä¸€æ¬¡æ“ä½œçš„è¿”å›å€¼
      // - formData: è¡¨å•æ•°æ®å¯¹è±¡ï¼Œå¯é€šè¿‡ formData.get("name") è·å–è¡¨å•å­—æ®µçš„å€¼
      const error = await updateName(formData.get("name"));

      // å¦‚æœæ“ä½œä¸­å‡ºç°äº†é”™è¯¯ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯
      if (error) {
        return error;
      }

      // å¦‚æœæ“ä½œæˆåŠŸï¼Œåˆ™æ‰§è¡Œé‡å®šå‘
      redirect("/path");
    }, 
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šåˆå§‹çŠ¶æ€ï¼Œè¿™é‡Œä¸º nullï¼Œå› ä¸ºåˆå§‹çŠ¶æ€å¹¶ä¸é‡è¦
    null
  );

  // è¿”å›è¡¨å•åŠç›¸å…³çš„çŠ¶æ€å’Œè¡Œä¸º
  return (
    <form action={submitAction}>
      <input type="text" name="name" />
      <button type="submit" disabled={isPending}>
        æäº¤
      </button>
      
      {/* é”™è¯¯ä¿¡æ¯ */}
      {error && <p>{error}</p>}
    </form>
  );
}
```

### useFormStatus

`useFormStatus` ç”¨æ¥è·å–è¡¨å•æäº¤çš„çŠ¶æ€ä¿¡æ¯ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```tsx
const { pending, data, method, action } = useFormStatus();
```

å…¶ä¸­ï¼š

- `pending`: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºçˆ¶çº§ `<form>` æ˜¯å¦æ­£åœ¨æäº¤ã€‚å¦‚æœä¸º `true`ï¼Œè¡¨ç¤ºè¡¨å•æ­£åœ¨æäº¤ï¼Œå¦åˆ™ä¸º `false`ã€‚
- `data`: ä¸€ä¸ªå®ç°äº† FormData æ¥å£çš„å¯¹è±¡ï¼ŒåŒ…å«çˆ¶çº§ `<form>` æ­£åœ¨æäº¤çš„æ•°æ®ã€‚å¦‚æœæ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æäº¤æˆ–æ²¡æœ‰çˆ¶çº§ `<form>`ï¼Œåˆ™ä¸º `null`ã€‚
- `method`: ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œè¡¨ç¤ºçˆ¶çº§ `<form>` ä½¿ç”¨çš„ HTTP æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ get æˆ– postã€‚
- `action`: ä¸€ä¸ªæŒ‡å‘ä¼ é€’ç»™çˆ¶çº§ `<form>` çš„ action å±æ€§çš„å‡½æ•°çš„å¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰çˆ¶çº§ `<form>`ï¼Œåˆ™è¯¥å±æ€§ä¸º `null`ã€‚

ä¾‹å¦‚ï¼Œåœ¨ form action ä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ `useFormStatus` è·å–è¡¨å•çŠ¶æ€ï¼š

```tsx
import { useFormStatus } from "react-dom";
import action from './actions';

function Submit() {
  const status = useFormStatus();
  return <button disabled={status.pending}>Submit</button>
}

export default function App() {
  return (
    <form action={action}>
      <Submit />
    </form>
  );
}
```

è¿™ä¸ªå†™æ³•æ˜¯ä¸æ˜¯ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Ÿå¦‚æœä½ æƒ³åˆ°äº† contextï¼Œé‚£å°±å¯¹äº†ï¼Œä½ å¯ä»¥ç†è§£ä¸º `useFormStatus` æ›¿ä»£äº†ä¸€éƒ¨åˆ† context provider çš„èƒ½åŠ›ï¼Œè€Œä¸”å†™æ³•æ¯” context è¦æ›´åŠ ç®€æ´ã€‚

ä½¿ç”¨ `useFormStatus` è¿˜æœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š

1. `useFormStatus` Hook å¿…é¡»åœ¨æ¸²æŸ“åœ¨ `<form>` å†…éƒ¨çš„ç»„ä»¶ä¸­è°ƒç”¨ã€‚
2. `useFormStatus` åªä¼šè¿”å›çˆ¶çº§ `<form>` çš„çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸ä¼šè¿”å›åŒä¸€ç»„ä»¶æˆ–å…¶å­ç»„ä»¶ä¸­ä»»ä½•å…¶ä»– `<form>` çš„çŠ¶æ€ä¿¡æ¯ã€‚

## ä¸€ä¸ªæ–° APIâ€”â€”use

ä»¥å‰ `use` æ˜¯è¢«å½’ç±»åˆ° hookï¼Œä½†æ˜¯ 19 ç‰ˆæœ¬çš„æ–‡æ¡£æŠŠ `use` æ”¾åœ¨ API æ–‡æ¡£é‡Œé¢ï¼Œæ‰€ä»¥å®ƒå°±æˆäº†ä¸€ä¸ªæ–°çš„ API å•¦ï¼

use ç”¨äºåœ¨ç»„ä»¶ä¸­è¯»å–èµ„æºçš„å€¼ï¼Œè¿™ä¸ªèµ„æºå¯ä»¥æ˜¯ä¸€ä¸ª Promise æˆ–è€…ä¸€ä¸ª contextã€‚

å®ƒçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```tsx
const value = use(resource);
```

åœ¨å®é™…ä»£ç ä¸­å¯èƒ½æ˜¯è¿™æ ·ï¼š

```tsx
import { use } from 'react';

function MessageComponent({ messagePromise }) {
  const message = use(messagePromise);
  const theme = use(ThemeContext);
  // ...
```

use ä¸»è¦æ˜¯ç»™ Next.js è¿™æ ·çš„ä¸Šå±‚æ¡†æ¶ä½¿ç”¨çš„ã€‚ä»¥ Next.js ä¸ºä¾‹ï¼Œå¦‚æœæ˜¯åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è·å–æ•°æ®ï¼Œæ›´æ¨èä½¿ç”¨ asyncâ€¦awaitï¼Œè€Œä¸æ˜¯ useã€‚å¦‚æœæ˜¯åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è·å–æ•°æ®ï¼Œä¹Ÿæ¨èåœ¨æœåŠ¡ç«¯ç»„ä»¶é‡Œåˆ›å»º Promiseï¼Œä»¥ props ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶è°ƒç”¨ã€‚

use è¿˜å¯ä»¥ä¸ Suspense è¾¹ç•Œå…±ç”¨ã€‚å¦‚æœè°ƒç”¨ `use` çš„ç»„ä»¶è¢«åŒ…è£¹åœ¨ä¸€ä¸ª Suspense è¾¹ç•Œå†…ï¼Œä¼šæ˜¾ç¤ºæŒ‡å®šçš„ fallbackã€‚ä¸€æ—¦ Promise è¢« resolveï¼ŒSuspense çš„ fallback å°±ä¼šè¢«è¿”å›çš„æ•°æ®æ›¿æ¢ã€‚å¦‚æœä¼ ç»™ `use` çš„ Promise è¢« rejectï¼Œæœ€è¿‘çš„é”™è¯¯è¾¹ç•Œçš„ fallback å°†ä¼šè¢«æ˜¾ç¤ºã€‚

## ref å’Œ context ç”¨æ³•ç®€åŒ–

å¦‚æœä½ åªä½¿ç”¨ React å®¢æˆ·ç«¯çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿™ä¸€èŠ‚ä»‹ç»çš„å˜æ›´ä¼šæ˜¯ä½ æœ€å…³æ³¨çš„ã€‚

### ref æŠ›å¼ƒ forwardRef

ä½ è¿˜è®°å¾—è¢« `forwardRef` æ”¯é…çš„ææƒ§å—ï¼Ÿä» React 19 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠ›å¼ƒ `forwardRef` äº†ã€‚ç°åœ¨å¼€å§‹ï¼Œref å¯ä»¥å½“ä½œ prop è¿›è¡Œä¼ é€’ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ç»„ä»¶ `TextInput`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„è¾“å…¥æ¡†ç»„ä»¶ï¼Œæ¥å—ä¸€ä¸ª `placeholder` å±æ€§ç”¨äºè®¾ç½®è¾“å…¥æ¡†çš„å ä½ç¬¦æ–‡æœ¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨çˆ¶ç»„ä»¶ä¸­è·å–åˆ°è¾“å…¥æ¡†çš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶èšç„¦åˆ°è¾“å…¥æ¡†ä¸Šï¼Œä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼š

```tsx
import React, { useRef } from 'react';

// å®šä¹‰ä¸€ä¸ªå‡½æ•°ç»„ä»¶ TextInput
function TextInput({ placeholder, ref }) {
  return <input placeholder={placeholder} ref={ref} />;
}

// çˆ¶ç»„ä»¶
function ParentComponent() {
  // åˆ›å»ºä¸€ä¸ª ref æ¥å­˜å‚¨è¾“å…¥æ¡†çš„å¼•ç”¨
  const inputRef = useRef(null);

  // åœ¨æŸä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­è·å–è¾“å…¥æ¡†çš„å¼•ç”¨å¹¶èšç„¦
  const focusInput = () => {
    inputRef.current.focus();
  };

  return (
    <div>
      {/* 
        å°† inputRef ä¼ é€’ç»™ TextInput ç»„ä»¶ï¼Œ
        è¿™æ · TextInput ç»„ä»¶å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª ref äº†
      */}
      <TextInput placeholder="Enter your name" ref={inputRef} />
      <button onClick={focusInput}>Focus Input</button>
    </div>
  );
}

export default ParentComponent;
```

æ˜¯ä¸æ˜¯å¿ƒæ™ºè´Ÿæ‹…æ¯”ä½¿ç”¨ forwardRef è¦è½»å¾—å¤šï¼Ÿ

### context å¯å½“ä½œ provider

ä»åœ¨ React 19 å¼€å§‹ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥å°† `<Context>` ç›´æ¥ä½œä¸º providerï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `<Context.Provider>`ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º `ThemeContext` çš„ contextï¼Œç”¨äºç®¡ç†ä¸»é¢˜ä¿¡æ¯ã€‚åœ¨ React 19 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ `<ThemeContext>` ä½œä¸ºæä¾›è€…ï¼š

```tsx
import React, { createContext } from 'react';

// åˆ›å»ºä¸€ä¸ªä¸»é¢˜ä¸Šä¸‹æ–‡
const ThemeContext = createContext('');

// App ç»„ä»¶ä½œä¸ºä¸»é¢˜æä¾›è€…
function App({ children }) {
  return (
    <ThemeContext value="dark">
      {children}
    </ThemeContext>
  );
}
```

æœªæ¥ `Context.Provider` ä¼šè¢«å¼ƒç”¨å¹¶ç§»é™¤ã€‚

## å…¶ä»–æ›´æ–°

æœ¬æ¬¡å‘å¸ƒçš„æ–°ç‰¹æ€§è¿˜æœ‰ä¸€äº›å±äºæ”¯æ’‘ç±»ç‰¹æ€§å’Œæ‹“å±•æœåŠ¡ç«¯èƒ½åŠ›çš„ç‰¹æ€§ï¼Œå› ä¸ºçº¯å®¢æˆ·ç«¯çš„ React å¼€å‘ä¸­ä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼Œæ‰€ä»¥ä¸å†è¯¦ç»†ä»‹ç»ï¼Œåªç®€å•æç‚¼è¦ç‚¹ï¼š

- æœåŠ¡ç«¯ç»„ä»¶å’Œ `server actions` å°†æˆä¸ºç¨³å®šç‰¹æ€§ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µå±äºç†Ÿæ‚‰ Next.js/Remix çš„äººå·²ç»çƒ‚ç†Ÿäºå¿ƒï¼Œè€Œä¸ç”¨ Next.js/Remix çš„äººæ ¹æœ¬ç”¨ä¸åˆ°ã€‚
- `useDeferredValue` å¢åŠ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯é€‰ï¼Œç”¨æ¥è¡¨ç¤ºåˆå§‹å€¼ã€‚å³ç°åœ¨ `useDeferredValue` çš„ç”¨æ³•æ˜¯è¿™æ ·ï¼š `const value = useDeferredValue(deferredValue, initialValue?);`
- æ”¯æŒåœ¨ React ä»£ç é‡Œç¼–å†™ document metadataï¼Œå³åœ¨é¡µé¢ç»„ä»¶ç¼–å†™`<title>` `<link>` å’Œ `<meta>` æ ‡ç­¾ä¼šè‡ªåŠ¨æ·»åŠ åº”ç”¨çš„ `<head>` ä¸Šé¢ï¼š
    
    ```tsx
    function BlogPost({post}) {
      return (
        <article>
          <h1>{post.title}</h1>
          <title>{post.title}</title>
          <meta name="author" content="Josh" />
          <link rel="author" href="https://twitter.com/joshcstory/" />
          <meta name="keywords" content={post.keywords} />
          <p>
            Eee equals em-see-squared...
          </p>
        </article>
      );
    }
    ```
    
- æ”¯æŒåœ¨ React ä»£ç é‡Œç¼–å†™ stylesheetsï¼Œå³åœ¨é¡µé¢ç»„ä»¶ç¼–å†™ `<link rel="stylesheet" href="...">`
- æ”¯æŒåœ¨ React ä»£ç é‡Œç¼–å†™ `<script async="" src="...">`ï¼Œæœ€ç»ˆä¹Ÿä¼šè‡ªåŠ¨æ·»åŠ åˆ° `<head>` æ ‡ç­¾å†…
- æ”¯æŒé¢„åŠ è½½èµ„æºï¼Œæœ€ç»ˆä¹Ÿä¼šè‡ªåŠ¨æ·»åŠ åˆ° `<head>` æ ‡ç­¾å†…ï¼š
    
    ```tsx
    import { prefetchDNS, preconnect, preload, preinit } from 'react-dom'
    function MyComponent() {
      preinit('https://.../path/to/some/script.js', {as: 'script' }) // loads and executes this script eagerly
      preload('https://.../path/to/font.woff', { as: 'font' }) // preloads this font
      preload('https://.../path/to/stylesheet.css', { as: 'style' }) // preloads this stylesheet
      prefetchDNS('https://...') // when you may not actually request anything from this host
      preconnect('https://...') // when you will request something but aren't sure what
    }
    ```
    

## æ€»ç»“

æœ€åï¼Œè®©æˆ‘ç”¨é»„ç„çš„ä¸€æ®µè¯ä½œä¸ºæ€»ç»“ï¼šã€ŒProbably the single most critical principle I've learned from React is to be fearless in defining new conceptual abstractions and never compromise on the accuracy and composability of these definitionsâ€”â€”æˆ‘ä» React èº«ä¸Šå­¦åˆ°çš„æœ€é‡è¦çš„ä¸€æ¡åŸåˆ™å¯èƒ½å°±æ˜¯ï¼Œåœ¨å®šä¹‰æ–°çš„æ¦‚å¿µæŠ½è±¡æ—¶è¦æ— æ‰€ç•æƒ§ï¼Œç»ä¸è¦åœ¨è¿™äº›å®šä¹‰çš„å‡†ç¡®æ€§å’Œå¯ç»„åˆæ€§ä¸Šå¦¥åã€ã€‚



## å…³äºæˆ‘

æˆ‘æ˜¯ä¸€åå…¨æ ˆå·¥ç¨‹å¸ˆï¼ŒNext.js å¼€æºæ‰‹è‰ºäººï¼ŒAIé™ä¸´æ´¾ã€‚

ä»Šå¹´è‡´åŠ›äº Next.js å’Œ Node.js é¢†åŸŸçš„å¼€æºé¡¹ç›®å¼€å‘å’ŒçŸ¥è¯†åˆ†äº«ã€‚

æ¬¢è¿åœ¨ä»¥ä¸‹å¹³å°å…³æ³¨æˆ‘ï¼š

- **Twitter(ä¸­æ–‡)**: [@weijunext](https://twitter.com/weijunext)
- **Github**: [Github](https://github.com/weijunext)
- **Blog**: [Jå®éªŒå®¤](https://weijunext.com/)
- **æ˜é‡‘**: [ç¨‹æ™®](https://juejin.cn/user/26044008768029)
- **çŸ¥ä¹**: [ç¨‹æ™®](https://www.zhihu.com/people/mo-mo-mo-89-12-11)
- **å³åˆ»**: [BigYeç¨‹æ™®](https://m.okjike.com/users/13EF1128-B51B-4D22-8B95-16BB406529F0)
- **å¾®ä¿¡å…¬ä¼—å·**: ã€ŒBigYeç¨‹æ™®ã€
- **å¾®ä¿¡äº¤æµç¾¤**: [å…¨æ ˆäº¤æµç¾¤](/make-a-friend)

